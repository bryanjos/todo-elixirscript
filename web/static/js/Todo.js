"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally {try{if(!_n&&_i["return"])_i["return"]();}finally {if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else {throw new TypeError("Invalid attempt to destructure non-iterable instance");}};}();var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value" in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else {return Array.from(arr);}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var Mailbox=function(){function Mailbox(){_classCallCheck(this,Mailbox);this.messages=[];}_createClass(Mailbox,[{key:"deliver",value:function deliver(message){this.messages.push(message);return message;}},{key:"get",value:function get(){return this.messages;}},{key:"isEmpty",value:function isEmpty(){return this.messages.length===0;}},{key:"removeAt",value:function removeAt(index){this.messages.splice(index,1);}}]);return Mailbox;}();var States={NORMAL:Symbol.for("normal"),KILL:Symbol.for("kill"),SUSPEND:Symbol.for("suspend"),CONTINUE:Symbol.for("continue"),RECEIVE:Symbol.for("receive"),SEND:Symbol.for("send"),SLEEPING:Symbol.for("sleeping"),RUNNING:Symbol.for("running"),SUSPENDED:Symbol.for("suspended"),STOPPED:Symbol.for("stopped"),SLEEP:Symbol.for("sleep"),EXIT:Symbol.for("exit"),NOMATCH:Symbol.for("no_match")};var Process=function Process(pid,mailbox){_classCallCheck(this,Process);this.pid=pid;this.mailbox=mailbox;this.status=States.STOPPED;this.dict={};};var Tuple=function(){function Tuple(){_classCallCheck(this,Tuple);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}this.values=Object.freeze(args);this.length=this.values.length;}_createClass(Tuple,[{key:"get",value:function get(index){return this.values[index];}},{key:"count",value:function count(){return this.values.length;}},{key:Symbol.iterator,value:function value(){return this.values[Symbol.iterator]();}},{key:"toString",value:function toString(){var i,s="";for(i=0;i<this.values.length;i++){if(s!==""){s+=", ";}s+=this.values[i].toString();}return "{"+s+"}";}},{key:"put_elem",value:function put_elem(index,elem){if(index===this.length){var _new_values=this.values.concat([elem]);return new (Function.prototype.bind.apply(Tuple,[null].concat(_toConsumableArray(_new_values))))();}var new_values=this.values.concat([]);new_values.splice(index,0,elem);return new (Function.prototype.bind.apply(Tuple,[null].concat(_toConsumableArray(new_values))))();}},{key:"remove_elem",value:function remove_elem(index){var new_values=this.values.concat([]);new_values.splice(index,1);return new (Function.prototype.bind.apply(Tuple,[null].concat(_toConsumableArray(new_values))))();}}]);return Tuple;}();var process_counter=-1;var PID=function(){function PID(){_classCallCheck(this,PID);process_counter=process_counter+1;this.id=process_counter;}_createClass(PID,[{key:"toString",value:function toString(){return "PID#<0."+this.id+".0>";}}]);return PID;}();var Integer=function Integer(){_classCallCheck(this,Integer);};var Float=function Float(){_classCallCheck(this,Float);};var ProcessSystem=function(){function ProcessSystem(){_classCallCheck(this,ProcessSystem);this.pids=new Map();this.mailboxes=new Map();this.names=new Map();this.links=new Map();this.current_process=null;this.suspended=new Map();this.main_process_pid=this.spawn();this.set_current(this.main_process_pid);}_createClass(ProcessSystem,[{key:"spawn",value:function spawn(){return this.add_proc(false).pid;}},{key:"spawn_link",value:function spawn_link(){return this.add_proc(true).pid;}},{key:"link",value:function link(pid){this.links.get(this.pid()).add(pid);this.links.get(pid).add(this.pid());}},{key:"unlink",value:function unlink(pid){this.links.get(this.pid()).delete(pid);this.links.get(pid).delete(this.pid());}},{key:"set_current",value:function set_current(id){var pid=this.pidof(id);if(pid!==null){this.current_process=this.pids.get(pid);this.current_process.status=States.RUNNING;}}},{key:"add_proc",value:function add_proc(linked){var newpid=new PID();var mailbox=new Mailbox();var newproc=new Process(newpid,mailbox);this.pids.set(newpid,newproc);this.mailboxes.set(newpid,mailbox);this.links.set(newpid,new Set());if(linked){this.link(newpid);}return newproc;}},{key:"remove_proc",value:function remove_proc(pid){this.pids.delete(pid);this.unregister(pid);if(this.links.has(pid)){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.links.get(pid)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var linkpid=_step.value;this.links.get(linkpid).delete(pid);}}catch(err){_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}this.links.delete(pid);}}},{key:"exit",value:function exit(id){var pid=this.pidof(id);this.remove_proc(id);}},{key:"register",value:function register(name,pid){if(!this.names.has(name)){this.names.set(name,pid);return name;}else {throw new Error("Name is already registered to another process");}}},{key:"registered",value:function registered(name){return this.names.has(name)?this.names.get(name):null;}},{key:"unregister",value:function unregister(pid){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.names.keys()[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var name=_step2.value;if(this.names.has(name)&&this.names.get(name)===pid){this.names.delete(name);}}}catch(err){_didIteratorError2=true;_iteratorError2=err;}finally {try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally {if(_didIteratorError2){throw _iteratorError2;}}}}},{key:"pid",value:function pid(){return this.current_process.pid;}},{key:"pidof",value:function pidof(id){if(id instanceof PID){return this.pids.has(id)?id:null;}else if(id instanceof Process){return id.pid;}else {var pid=this.registered(id);if(pid===null)throw "Process name not registered: "+id+" ("+(typeof id==="undefined"?"undefined":_typeof(id))+")";return pid;}}},{key:"put",value:function put(id,key,value){var pid=this.pidof(id);var process=this.pids.get(pid);process.dict[key]=value;}},{key:"get",value:function get(id,key){var pid=this.pidof(id);var process=this.pids.get(pid);if(key!=null){return process.dict[key];}else {return process.dict;}}},{key:"get_keys",value:function get_keys(id){var pid=this.pidof(id);var process=this.pids.get(pid);return Object.keys(process.dict);}},{key:"erase",value:function erase(id,key){var pid=this.pidof(id);var process=this.pids.get(pid);if(key!=null){delete process.dict[key];}else {process.dict={};}}}]);return ProcessSystem;}();var BitString=function(){function BitString(){_classCallCheck(this,BitString);for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}this.value=Object.freeze(this.process(args));this.length=this.value.length;this.bit_size=this.length*8;this.byte_size=this.length;}_createClass(BitString,[{key:"get",value:function get(index){return this.value[index];}},{key:"count",value:function count(){return this.value.length;}},{key:"slice",value:function slice(start){var end=arguments.length<=1||arguments[1]===undefined?null:arguments[1];var s=this.value.slice(start,end);var ms=s.map(function(elem){return BitString.integer(elem);});return new (Function.prototype.bind.apply(BitString,[null].concat(_toConsumableArray(ms))))();}},{key:Symbol.iterator,value:function value(){return this.value[Symbol.iterator]();}},{key:"toString",value:function toString(){var i,s="";for(i=0;i<this.count();i++){if(s!==""){s+=", ";}s+=this.get(i).toString();}return "<<"+s+">>";}},{key:"process",value:function process(bitStringParts){var processed_values=[];var i;for(i=0;i<bitStringParts.length;i++){var processed_value=this['process_'+bitStringParts[i].type](bitStringParts[i]);var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=bitStringParts[i].attributes[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var attr=_step3.value;processed_value=this['process_'+attr](processed_value);}}catch(err){_didIteratorError3=true;_iteratorError3=err;}finally {try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return();}}finally {if(_didIteratorError3){throw _iteratorError3;}}}processed_values=processed_values.concat(processed_value);}return processed_values;}},{key:"process_integer",value:function process_integer(value){return value.value;}},{key:"process_float",value:function process_float(value){if(value.size===64){return BitString.float64ToBytes(value.value);}else if(value.size===32){return BitString.float32ToBytes(value.value);}throw new Error('Invalid size for float');}},{key:"process_bitstring",value:function process_bitstring(value){return value.value.value;}},{key:"process_binary",value:function process_binary(value){return BitString.toUTF8Array(value.value);}},{key:"process_utf8",value:function process_utf8(value){return BitString.toUTF8Array(value.value);}},{key:"process_utf16",value:function process_utf16(value){return BitString.toUTF16Array(value.value);}},{key:"process_utf32",value:function process_utf32(value){return BitString.toUTF32Array(value.value);}},{key:"process_signed",value:function process_signed(value){return new Uint8Array([value])[0];}},{key:"process_unsigned",value:function process_unsigned(value){return value;}},{key:"process_native",value:function process_native(value){return value;}},{key:"process_big",value:function process_big(value){return value;}},{key:"process_little",value:function process_little(value){return value.reverse();}},{key:"process_size",value:function process_size(value){return value;}},{key:"process_unit",value:function process_unit(value){return value;}}],[{key:"integer",value:function integer(value){return BitString.wrap(value,{'type':'integer','unit':1,'size':8});}},{key:"float",value:function float(value){return BitString.wrap(value,{'type':'float','unit':1,'size':64});}},{key:"bitstring",value:function bitstring(value){return BitString.wrap(value,{'type':'bitstring','unit':1,'size':value.bit_size});}},{key:"bits",value:function bits(value){return BitString.bitstring(value);}},{key:"binary",value:function binary(value){return BitString.wrap(value,{'type':'binary','unit':8,'size':value.length});}},{key:"bytes",value:function bytes(value){return BitString.binary(value);}},{key:"utf8",value:function utf8(value){return BitString.wrap(value,{'type':'utf8','unit':1,'size':value.length});}},{key:"utf16",value:function utf16(value){return BitString.wrap(value,{'type':'utf16','unit':1,'size':value.length*2});}},{key:"utf32",value:function utf32(value){return BitString.wrap(value,{'type':'utf32','unit':1,'size':value.length*4});}},{key:"signed",value:function signed(value){return BitString.wrap(value,{},'signed');}},{key:"unsigned",value:function unsigned(value){return BitString.wrap(value,{},'unsigned');}},{key:"native",value:function native(value){return BitString.wrap(value,{},'native');}},{key:"big",value:function big(value){return BitString.wrap(value,{},'big');}},{key:"little",value:function little(value){return BitString.wrap(value,{},'little');}},{key:"size",value:function size(value,count){return BitString.wrap(value,{'size':count});}},{key:"unit",value:function unit(value,count){return BitString.wrap(value,{'unit':count});}},{key:"wrap",value:function wrap(value,opt){var new_attribute=arguments.length<=2||arguments[2]===undefined?null:arguments[2];var the_value=value;if(!(value instanceof Object)){the_value={'value':value,'attributes':[]};}the_value=Object.assign(the_value,opt);if(new_attribute){the_value.attributes.push(new_attribute);}return the_value;}},{key:"toUTF8Array",value:function toUTF8Array(str){var utf8=[];for(var i=0;i<str.length;i++){var charcode=str.charCodeAt(i);if(charcode<0x80){utf8.push(charcode);}else if(charcode<0x800){utf8.push(0xc0|charcode>>6,0x80|charcode&0x3f);}else if(charcode<0xd800||charcode>=0xe000){utf8.push(0xe0|charcode>>12,0x80|charcode>>6&0x3f,0x80|charcode&0x3f);} // surrogate pair
else {i++; // UTF-16 encodes 0x10000-0x10FFFF by
// subtracting 0x10000 and splitting the
// 20 bits of 0x0-0xFFFFF into two halves
charcode=0x10000+((charcode&0x3ff)<<10|str.charCodeAt(i)&0x3ff);utf8.push(0xf0|charcode>>18,0x80|charcode>>12&0x3f,0x80|charcode>>6&0x3f,0x80|charcode&0x3f);}}return utf8;}},{key:"toUTF16Array",value:function toUTF16Array(str){var utf16=[];for(var i=0;i<str.length;i++){var codePoint=str.codePointAt(i);if(codePoint<=255){utf16.push(0);utf16.push(codePoint);}else {utf16.push(codePoint>>8&0xFF);utf16.push(codePoint&0xFF);}}return utf16;}},{key:"toUTF32Array",value:function toUTF32Array(str){var utf32=[];for(var i=0;i<str.length;i++){var codePoint=str.codePointAt(i);if(codePoint<=255){utf32.push(0);utf32.push(0);utf32.push(0);utf32.push(codePoint);}else {utf32.push(0);utf32.push(0);utf32.push(codePoint>>8&0xFF);utf32.push(codePoint&0xFF);}}return utf32;} //http://stackoverflow.com/questions/2003493/javascript-float-from-to-bits
},{key:"float32ToBytes",value:function float32ToBytes(f){var bytes=[];var buf=new ArrayBuffer(4);new Float32Array(buf)[0]=f;var intVersion=new Uint32Array(buf)[0];bytes.push(intVersion>>24&0xFF);bytes.push(intVersion>>16&0xFF);bytes.push(intVersion>>8&0xFF);bytes.push(intVersion&0xFF);return bytes;}},{key:"float64ToBytes",value:function float64ToBytes(f){var bytes=[];var buf=new ArrayBuffer(8);new Float64Array(buf)[0]=f;var intVersion1=new Uint32Array(buf)[0];var intVersion2=new Uint32Array(buf)[1];bytes.push(intVersion2>>24&0xFF);bytes.push(intVersion2>>16&0xFF);bytes.push(intVersion2>>8&0xFF);bytes.push(intVersion2&0xFF);bytes.push(intVersion1>>24&0xFF);bytes.push(intVersion1>>16&0xFF);bytes.push(intVersion1>>8&0xFF);bytes.push(intVersion1&0xFF);return bytes;}}]);return BitString;}();var Variable=function Variable(){var default_value=arguments.length<=0||arguments[0]===undefined?Symbol.for("elixirscript.no_value"):arguments[0];_classCallCheck(this,Variable);this.default_value=default_value;};var Wildcard=function Wildcard(){_classCallCheck(this,Wildcard);};var StartsWith=function StartsWith(prefix){_classCallCheck(this,StartsWith);this.prefix=prefix;};var Capture=function Capture(value){_classCallCheck(this,Capture);this.value=value;};var HeadTail=function HeadTail(){var head=arguments.length<=0||arguments[0]===undefined?null:arguments[0];var tail=arguments.length<=1||arguments[1]===undefined?null:arguments[1];_classCallCheck(this,HeadTail);this.head=head;this.tail=tail;};var Type=function Type(type){var objPattern=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];_classCallCheck(this,Type);this.type=type;this.objPattern=objPattern;};var Bound=function Bound(value){_classCallCheck(this,Bound);this.value=value;};var BitStringMatch=function(){function BitStringMatch(){_classCallCheck(this,BitStringMatch);for(var _len3=arguments.length,values=Array(_len3),_key3=0;_key3<_len3;_key3++){values[_key3]=arguments[_key3];}this.values=values;}_createClass(BitStringMatch,[{key:"length",value:function length(){return values.length;}},{key:"bit_size",value:function bit_size(){return this.byte_size()*8;}},{key:"byte_size",value:function byte_size(){var s=0;var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=this.values[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var val=_step4.value;s=s+val.unit*val.size/8;}}catch(err){_didIteratorError4=true;_iteratorError4=err;}finally {try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return();}}finally {if(_didIteratorError4){throw _iteratorError4;}}}return s;}},{key:"getValue",value:function getValue(index){return this.values(index);}},{key:"getSizeOfValue",value:function getSizeOfValue(index){var val=this.getValue(index);return val.unit*val.size;}},{key:"getTypeOfValue",value:function getTypeOfValue(index){return this.getValue(index).type;}}]);return BitStringMatch;}();function variable(){var default_value=arguments.length<=0||arguments[0]===undefined?Symbol.for("elixirscript.no_value"):arguments[0];return new Variable(default_value);}function wildcard(){return new Wildcard();}function startsWith(prefix){return new StartsWith(prefix);}function capture(value){return new Capture(value);}function headTail(){var head=arguments.length<=0||arguments[0]===undefined?null:arguments[0];var tail=arguments.length<=1||arguments[1]===undefined?null:arguments[1];return new HeadTail(head,tail);}function type(type){var objPattern=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];return new Type(type,objPattern);}function bound(value){return new Bound(value);}function bitStringMatch(){for(var _len4=arguments.length,values=Array(_len4),_key4=0;_key4<_len4;_key4++){values[_key4]=arguments[_key4];}return new (Function.prototype.bind.apply(BitStringMatch,[null].concat(values)))();}function is_number(value){return typeof value==='number';}function is_string(value){return typeof value==='string';}function is_boolean(value){return typeof value==='boolean';}function is_symbol(value){return (typeof value==="undefined"?"undefined":_typeof(value))==='symbol';}function is_null(value){return value===null;}function is_undefined(value){return typeof value==='undefined';}function is_function(value){return Object.prototype.toString.call(value)=='[object Function]';}function is_variable(value){return value instanceof Variable;}function is_wildcard(value){return value instanceof Wildcard;}function is_headTail(value){return value instanceof HeadTail;}function is_capture(value){return value instanceof Capture;}function is_type(value){return value instanceof Type;}function is_startsWith(value){return value instanceof StartsWith;}function is_bound(value){return value instanceof Bound;}function is_object(value){return (typeof value==="undefined"?"undefined":_typeof(value))==='object';}function is_array(value){return Array.isArray(value);}function is_bitstring(value){return value instanceof BitStringMatch;}var Checks={is_number:is_number,is_string:is_string,is_boolean:is_boolean,is_symbol:is_symbol,is_null:is_null,is_undefined:is_undefined,is_function:is_function,is_variable:is_variable,is_wildcard:is_wildcard,is_headTail:is_headTail,is_capture:is_capture,is_type:is_type,is_startsWith:is_startsWith,is_bound:is_bound,is_object:is_object,is_array:is_array,is_bitstring:is_bitstring};function resolveSymbol(pattern){return function(value){return Checks.is_symbol(value)&&value===pattern;};}function resolveString(pattern){return function(value){return Checks.is_string(value)&&value===pattern;};}function resolveNumber(pattern){return function(value){return Checks.is_number(value)&&value===pattern;};}function resolveBoolean(pattern){return function(value){return Checks.is_boolean(value)&&value===pattern;};}function resolveFunction(pattern){return function(value){return Checks.is_function(value)&&value===pattern;};}function resolveNull(pattern){return function(value){return Checks.is_null(value);};}function resolveBound(pattern){return function(value,args){if((typeof value==="undefined"?"undefined":_typeof(value))===_typeof(pattern.value)&&value===pattern.value){args.push(value);return true;}return false;};}function resolveWildcard(){return function(){return true;};}function resolveVariable(){return function(value,args){args.push(value);return true;};}function resolveHeadTail(pattern){var headMatches=buildMatch(pattern.head);var tailMatches=buildMatch(pattern.tail);return function(value,args){if(!Checks.is_array(value)||value.length<2){return false;}var head=value[0];var tail=value.slice(1);if(headMatches(head,args)&&tailMatches(tail,args)){return true;}};}function resolveCapture(pattern){var matches=buildMatch(pattern.value);return function(value,args){if(matches(value,args)){args.push(value);return true;}return false;};}function resolveStartsWith(pattern){var prefix=pattern.prefix;return function(value,args){if(Checks.is_string(value)&&value.startsWith(prefix)){args.push(value.substring(prefix.length));return true;}return false;};}function resolveType(pattern){return function(value,args){if(value instanceof pattern.type){var matches=buildMatch(pattern.objPattern);return matches(value,args)&&args.push(value)>0;}return false;};}function resolveArray(pattern){var matches=pattern.map(function(x){return buildMatch(x);});return function(value,args){if(!Checks.is_array(value)||value.length!=pattern.length){return false;}return value.every(function(v,i){return matches[i](value[i],args);});};}function resolveObject(pattern){var matches={};var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=Object.keys(pattern).concat(Object.getOwnPropertySymbols(pattern))[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var key=_step5.value;matches[key]=buildMatch(pattern[key]);}}catch(err){_didIteratorError5=true;_iteratorError5=err;}finally {try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return();}}finally {if(_didIteratorError5){throw _iteratorError5;}}}return function(value,args){if(!Checks.is_object(value)||pattern.length>value.length){return false;}var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=Object.keys(pattern).concat(Object.getOwnPropertySymbols(pattern))[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var key=_step6.value;if(!(key in value)||!matches[key](value[key],args)){return false;}}}catch(err){_didIteratorError6=true;_iteratorError6=err;}finally {try{if(!_iteratorNormalCompletion6&&_iterator6.return){_iterator6.return();}}finally {if(_didIteratorError6){throw _iteratorError6;}}}return true;};}function resolveBitString(pattern){var patternBitString=[];var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=pattern.values[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var bitstringMatchPart=_step7.value;if(Checks.is_variable(bitstringMatchPart.value)){var size=getSize(bitstringMatchPart.unit,bitstringMatchPart.size);fillArray(patternBitString,size);}else {patternBitString=patternBitString.concat(new BitString(bitstringMatchPart).value);}}}catch(err){_didIteratorError7=true;_iteratorError7=err;}finally {try{if(!_iteratorNormalCompletion7&&_iterator7.return){_iterator7.return();}}finally {if(_didIteratorError7){throw _iteratorError7;}}}var patternValues=pattern.values;return function(value,args){var bsValue=null;if(!Checks.is_string(value)&&!(value instanceof BitString)){return false;}if(Checks.is_string(value)){bsValue=new BitString(BitString.binary(value));}else {bsValue=value;}var beginningIndex=0;for(var i=0;i<patternValues.length;i++){var bitstringMatchPart=patternValues[i];if(Checks.is_variable(bitstringMatchPart.value)&&bitstringMatchPart.type=='binary'&&bitstringMatchPart.size===undefined&&i<patternValues.length-1){throw new Error("a binary field without size is only allowed at the end of a binary pattern");}var size=0;var bsValueArrayPart=[];var patternBitStringArrayPart=[];size=getSize(bitstringMatchPart.unit,bitstringMatchPart.size);if(i===patternValues.length-1){bsValueArrayPart=bsValue.value.slice(beginningIndex);patternBitStringArrayPart=patternBitString.slice(beginningIndex);}else {bsValueArrayPart=bsValue.value.slice(beginningIndex,beginningIndex+size);patternBitStringArrayPart=patternBitString.slice(beginningIndex,beginningIndex+size);}if(Checks.is_variable(bitstringMatchPart.value)){switch(bitstringMatchPart.type){case 'integer':if(bitstringMatchPart.attributes&&bitstringMatchPart.attributes.indexOf("signed")!=-1){args.push(new Int8Array([bsValueArrayPart[0]])[0]);}else {args.push(new Uint8Array([bsValueArrayPart[0]])[0]);}break;case 'float':if(size===64){args.push(Float64Array.from(bsValueArrayPart)[0]);}else if(size===32){args.push(Float32Array.from(bsValueArrayPart)[0]);}else {return false;}break;case 'bitstring':args.push(createBitString(bsValueArrayPart));break;case 'binary':args.push(String.fromCharCode.apply(null,new Uint8Array(bsValueArrayPart)));break;case 'utf8':args.push(String.fromCharCode.apply(null,new Uint8Array(bsValueArrayPart)));break;case 'utf16':args.push(String.fromCharCode.apply(null,new Uint16Array(bsValueArrayPart)));break;case 'utf32':args.push(String.fromCharCode.apply(null,new Uint32Array(bsValueArrayPart)));break;default:return false;}}else if(!arraysEqual(bsValueArrayPart,patternBitStringArrayPart)){return false;}beginningIndex=beginningIndex+size;}return true;};}function getSize(unit,size){return unit*size/8;}function arraysEqual(a,b){if(a===b)return true;if(a==null||b==null)return false;if(a.length!=b.length)return false;for(var i=0;i<a.length;++i){if(a[i]!==b[i])return false;}return true;}function fillArray(arr,num){for(var i=0;i<num;i++){arr.push(0);}}function createBitString(arr){var integerParts=arr.map(function(elem){return BitString.integer(elem);});return new (Function.prototype.bind.apply(BitString,[null].concat(_toConsumableArray(integerParts))))();}function resolveNoMatch(){return function(){return false;};}var Resolvers={resolveBound:resolveBound,resolveWildcard:resolveWildcard,resolveVariable:resolveVariable,resolveHeadTail:resolveHeadTail,resolveCapture:resolveCapture,resolveStartsWith:resolveStartsWith,resolveType:resolveType,resolveArray:resolveArray,resolveObject:resolveObject,resolveNoMatch:resolveNoMatch,resolveSymbol:resolveSymbol,resolveString:resolveString,resolveNumber:resolveNumber,resolveBoolean:resolveBoolean,resolveFunction:resolveFunction,resolveNull:resolveNull,resolveBitString:resolveBitString};function buildMatch(pattern){if(Checks.is_variable(pattern)){return Resolvers.resolveVariable(pattern);}if(Checks.is_wildcard(pattern)){return Resolvers.resolveWildcard(pattern);}if(Checks.is_undefined(pattern)){return Resolvers.resolveWildcard(pattern);}if(Checks.is_headTail(pattern)){return Resolvers.resolveHeadTail(pattern);}if(Checks.is_startsWith(pattern)){return Resolvers.resolveStartsWith(pattern);}if(Checks.is_capture(pattern)){return Resolvers.resolveCapture(pattern);}if(Checks.is_bound(pattern)){return Resolvers.resolveBound(pattern);}if(Checks.is_type(pattern)){return Resolvers.resolveType(pattern);}if(Checks.is_array(pattern)){return Resolvers.resolveArray(pattern);}if(Checks.is_number(pattern)){return Resolvers.resolveNumber(pattern);}if(Checks.is_string(pattern)){return Resolvers.resolveString(pattern);}if(Checks.is_boolean(pattern)){return Resolvers.resolveBoolean(pattern);}if(Checks.is_symbol(pattern)){return Resolvers.resolveSymbol(pattern);}if(Checks.is_null(pattern)){return Resolvers.resolveNull(pattern);}if(Checks.is_bitstring(pattern)){return Resolvers.resolveBitString(pattern);}if(Checks.is_object(pattern)){return Resolvers.resolveObject(pattern);}return Resolvers.resolveNoMatch();}var MatchError=function(_Error){_inherits(MatchError,_Error);function MatchError(arg){_classCallCheck(this,MatchError);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(MatchError).call(this));if((typeof arg==="undefined"?"undefined":_typeof(arg))==='symbol'){_this.message='No match for: '+arg.toString();}else if(Array.isArray(arg)){var mappedValues=arg.map(function(x){return x.toString();});_this.message='No match for: '+mappedValues;}else {_this.message='No match for: '+arg;}_this.stack=new Error().stack;_this.name=_this.constructor.name;return _this;}return MatchError;}(Error);var Case=function Case(pattern,fn){var guard=arguments.length<=2||arguments[2]===undefined?function(){return true;}:arguments[2];_classCallCheck(this,Case);this.pattern=buildMatch(pattern);this.arity=pattern.length;this.optionals=getOptionalValues(pattern);this.fn=fn;this.guard=guard;};function make_case(pattern,fn){var guard=arguments.length<=2||arguments[2]===undefined?function(){return true;}:arguments[2];return new Case(pattern,fn,guard);}function defmatch(){for(var _len5=arguments.length,cases=Array(_len5),_key5=0;_key5<_len5;_key5++){cases[_key5]=arguments[_key5];}return function(){for(var _len6=arguments.length,args=Array(_len6),_key6=0;_key6<_len6;_key6++){args[_key6]=arguments[_key6];}var _iteratorNormalCompletion8=true;var _didIteratorError8=false;var _iteratorError8=undefined;try{for(var _iterator8=cases[Symbol.iterator](),_step8;!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=true){var processedCase=_step8.value;var result=[];args=fillInOptionalValues(args,processedCase.arity,processedCase.optionals);if(processedCase.pattern(args,result)&&processedCase.guard.apply(this,result)){return processedCase.fn.apply(this,result);}}}catch(err){_didIteratorError8=true;_iteratorError8=err;}finally {try{if(!_iteratorNormalCompletion8&&_iterator8.return){_iterator8.return();}}finally {if(_didIteratorError8){throw _iteratorError8;}}}throw new MatchError(args);};}function getOptionalValues(pattern){var optionals=[];for(var i=0;i<pattern.length;i++){if(pattern[i] instanceof Variable&&pattern[i].default_value!=Symbol.for("elixirscript.no_value")){optionals.push([i,pattern[i].default_value]);}}return optionals;}function fillInOptionalValues(args,arity,optionals){if(args.length===arity||optionals.length===0){return args;}if(args.length+optionals.length<arity){return args;}var numberOfOptionalsToFill=arity-args.length;var optionalsToRemove=optionals.length-numberOfOptionalsToFill;var optionalsToUse=optionals.slice(optionalsToRemove);var _iteratorNormalCompletion9=true;var _didIteratorError9=false;var _iteratorError9=undefined;try{for(var _iterator9=optionalsToUse[Symbol.iterator](),_step9;!(_iteratorNormalCompletion9=(_step9=_iterator9.next()).done);_iteratorNormalCompletion9=true){var _step9$value=_slicedToArray(_step9.value,2);var index=_step9$value[0];var value=_step9$value[1];args.splice(index,0,value);if(args.length===arity){break;}}}catch(err){_didIteratorError9=true;_iteratorError9=err;}finally {try{if(!_iteratorNormalCompletion9&&_iterator9.return){_iterator9.return();}}finally {if(_didIteratorError9){throw _iteratorError9;}}}return args;}function match(pattern,expr){var guard=arguments.length<=2||arguments[2]===undefined?function(){return true;}:arguments[2];var result=[];var processedPattern=buildMatch(pattern);if(processedPattern(expr,result)&&guard.apply(this,result)){return result;}else {throw new MatchError(expr);}}function match_no_throw(pattern,expr){var guard=arguments.length<=2||arguments[2]===undefined?function(){return true;}:arguments[2];try{return match(pattern,expr,guard);}catch(e){if(e instanceof MatchError||e.message.startsWith('No match for:')){return null;}throw e;}}var Patterns={defmatch:defmatch,match:match,MatchError:MatchError,match_no_throw:match_no_throw,variable:variable,wildcard:wildcard,startsWith:startsWith,capture:capture,headTail:headTail,type:type,bound:bound,Case:Case,make_case:make_case,bitStringMatch:bitStringMatch}; //https://github.com/airportyh/protomorphism
var Protocol=function(){function Protocol(spec){_classCallCheck(this,Protocol);this.registry=new Map();this.fallback=null;for(var funName in spec){this[funName]=createFun(funName).bind(this);}function createFun(funName){return function(){for(var _len7=arguments.length,args=Array(_len7),_key7=0;_key7<_len7;_key7++){args[_key7]=arguments[_key7];}var thing=args[0];var fun=null;if(Number.isInteger(thing)&&this.hasImplementation(Integer)){fun=this.registry.get(Integer)[funName];}else if(typeof thing==="number"&&!Number.isInteger(thing)&&this.hasImplementation(Float)){fun=this.registry.get(Float)[funName];}else if(this.hasImplementation(thing)){fun=this.registry.get(thing.constructor)[funName];}else if(this.fallback){fun=this.fallback[funName];}if(fun!=null){var retval=fun.apply(this,args);return retval;}throw new Error("No implementation found for "+thing);};}}_createClass(Protocol,[{key:"implementation",value:function implementation(type,_implementation){if(type===null){this.fallback=_implementation;}else {this.registry.set(type,_implementation);}}},{key:"hasImplementation",value:function hasImplementation(thing){if(thing===Integer||thing===Float){return this.registry.has(thing);}return this.registry.has(thing.constructor);}}]);return Protocol;}();function call_property(item,property){var prop=null;if(typeof item==="number"||(typeof item==="undefined"?"undefined":_typeof(item))==="symbol"||typeof item==="boolean"||typeof item==="string"){if(item[property]!==undefined){prop=property;}else if(item[Symbol.for(property)]!==undefined){prop=Symbol.for(property);}}else {if(property in item){prop=property;}else if(Symbol.for(property) in item){prop=Symbol.for(property);}}if(prop===null){throw new Error("Property "+property+" not found in "+item);}if(item[prop] instanceof Function){return item[prop]();}else {return item[prop];}}function apply(){for(var _len8=arguments.length,args=Array(_len8),_key8=0;_key8<_len8;_key8++){args[_key8]=arguments[_key8];}if(args.length===2){args[0].apply(null,args.slice(1));}else {args[0][args[1]].apply(null,args.slice(2));}}function contains(left,right){var _iteratorNormalCompletion10=true;var _didIteratorError10=false;var _iteratorError10=undefined;try{for(var _iterator10=right[Symbol.iterator](),_step10;!(_iteratorNormalCompletion10=(_step10=_iterator10.next()).done);_iteratorNormalCompletion10=true){var _x15=_step10.value;if(Patterns.match_no_throw(left,_x15)!=null){return true;}}}catch(err){_didIteratorError10=true;_iteratorError10=err;}finally {try{if(!_iteratorNormalCompletion10&&_iterator10.return){_iterator10.return();}}finally {if(_didIteratorError10){throw _iteratorError10;}}}return false;}function get_global(){if(typeof self!=="undefined"){return self;}else if(typeof window!=="undefined"){return window;}else if(typeof global!=="undefined"){return global;}throw new Error("No global state found");}function defstruct(defaults){return function(){function _class(){var update=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,_class);var the_values=Object.assign(defaults,update);Object.assign(this,the_values);}_createClass(_class,null,[{key:"create",value:function create(){var updates=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var x=new this(updates);return Object.freeze(x);}}]);return _class;}();}function defexception(defaults){return function(_Error2){_inherits(_class2,_Error2);function _class2(){var update=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,_class2);var message=update.message||"";var _this2=_possibleConstructorReturn(this,Object.getPrototypeOf(_class2).call(this,message));var the_values=Object.assign(defaults,update);Object.assign(_this2,the_values);_this2.name=_this2.constructor.name;_this2.message=message;_this2[SpecialForms.atom("__exception__")]=true;Error.captureStackTrace(_this2,_this2.constructor.name);return _this2;}_createClass(_class2,null,[{key:"create",value:function create(){var updates=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var x=new this(updates);return Object.freeze(x);}}]);return _class2;}(Error);}function defprotocol(spec){return new Protocol(spec);}function defimpl(protocol,type,impl){protocol.implementation(type,impl);}function get_object_keys(obj){return Object.keys(obj).concat(Object.getOwnPropertySymbols(obj));}function is_valid_character(codepoint){try{return String.fromCodePoint(codepoint)!=null;}catch(e){return false;}} //https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#Solution_2_%E2%80%93_rewrite_the_DOMs_atob()_and_btoa()_using_JavaScript's_TypedArrays_and_UTF-8
function b64EncodeUnicode(str){return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function(match,p1){return String.fromCharCode('0x'+p1);}));}function delete_property_from_map(map,property){var new_map=Object.assign(Object.create(map.constructor.prototype),map);delete new_map[property];return Object.freeze(new_map);}function class_to_obj(map){var new_map=Object.assign({},map);return Object.freeze(new_map);}function add_property_to_map(map,property,value){var new_map=Object.assign({},map);new_map[property]=value;return Object.freeze(new_map);}function update_map(map,property,value){if(property in get_object_keys(map)){return add_property_to_map(map,property,value);}throw "map does not have key";}function bnot(expr){return ~expr;}function band(left,right){return left&right;}function bor(left,right){return left|right;}function bsl(left,right){return left<<right;}function bsr(left,right){return left>>right;}function bxor(left,right){return left^right;}function zip(list_of_lists){if(list_of_lists.length===0){return Object.freeze([]);}var new_value=[];var smallest_length=list_of_lists[0];var _iteratorNormalCompletion11=true;var _didIteratorError11=false;var _iteratorError11=undefined;try{for(var _iterator11=list_of_lists[Symbol.iterator](),_step11;!(_iteratorNormalCompletion11=(_step11=_iterator11.next()).done);_iteratorNormalCompletion11=true){var _x20=_step11.value;if(_x20.length<smallest_length){smallest_length=_x20.length;}}}catch(err){_didIteratorError11=true;_iteratorError11=err;}finally {try{if(!_iteratorNormalCompletion11&&_iterator11.return){_iterator11.return();}}finally {if(_didIteratorError11){throw _iteratorError11;}}}for(var i=0;i<smallest_length;i++){var current_value=[];for(var j=0;j<list_of_lists.length;j++){current_value.push(list_of_lists[j][i]);}new_value.push(new (Function.prototype.bind.apply(Tuple,[null].concat(current_value)))());}return Object.freeze(new_value);}function can_decode64(data){try{atob(data);return true;}catch(e){return false;}}function remove_from_list(list,element){var found=false;return list.filter(function(elem){if(!found&&elem===element){found=true;return false;}return true;});}function foldl(fun,acc,list){var acc1=acc;var _iteratorNormalCompletion12=true;var _didIteratorError12=false;var _iteratorError12=undefined;try{for(var _iterator12=list[Symbol.iterator](),_step12;!(_iteratorNormalCompletion12=(_step12=_iterator12.next()).done);_iteratorNormalCompletion12=true){var el=_step12.value;acc1=fun(el,acc1);}}catch(err){_didIteratorError12=true;_iteratorError12=err;}finally {try{if(!_iteratorNormalCompletion12&&_iterator12.return){_iterator12.return();}}finally {if(_didIteratorError12){throw _iteratorError12;}}}return acc1;}function foldr(fun,acc,list){var acc1=acc;for(var i=list.length-1;i>=0;i--){acc1=fun(list[i],acc1);}return acc1;}function keyfind(key,n,tuplelist){for(var i=tuplelist.length-1;i>=0;i--){if(tuplelist[i].get(n)===key){return tuplelist[i];}}return false;}function keydelete(key,n,tuplelist){for(var i=tuplelist.length-1;i>=0;i--){if(tuplelist[i].get(n)===key){return tuplelist.concat([]).splice(i,1);}}return tuplelist;}function keystore(key,n,list,newtuple){for(var i=list.length-1;i>=0;i--){if(list[i].get(n)===key){return list.concat([]).splice(i,1,newtuple);}}return list.concat([]).push(newtuple);}function keymember(key,n,list){for(var i=list.length-1;i>=0;i--){if(list[i].get(n)===key){return true;}}return false;}function keytake(key,n,list){if(!keymember(key,n,list)){return false;}var tuple=keyfind(key,n,list);return new Tuple(tuple.get(n),tuple,keydelete(key,n,list));}function keyreplace(key,n,list,newtuple){for(var i=tuplelist.length-1;i>=0;i--){if(tuplelist[i].get(n)===key){return tuplelist.concat([]).splice(i,1,newtuple);}}return tuplelist;}function reverse(list){return list.concat([]).reverse();}function maps_find(key,map){if(key in get_object_keys(map)){return new Tuple(Symbol.for("ok"),map[key]);}else {return Symbol.for("error");}}function flatten(list){var tail=arguments.length<=1||arguments[1]===undefined?[]:arguments[1];var new_list=[];var _iteratorNormalCompletion13=true;var _didIteratorError13=false;var _iteratorError13=undefined;try{for(var _iterator13=list[Symbol.iterator](),_step13;!(_iteratorNormalCompletion13=(_step13=_iterator13.next()).done);_iteratorNormalCompletion13=true){var e=_step13.value;if(isArray(e)){new_list=new_list.concat(flatten(e));}else {new_list.push(e);}}}catch(err){_didIteratorError13=true;_iteratorError13=err;}finally {try{if(!_iteratorNormalCompletion13&&_iterator13.return){_iterator13.return();}}finally {if(_didIteratorError13){throw _iteratorError13;}}}return Object.freeze(new_list.concat(tail));}function duplicate(n,elem){var list=[];for(var i=0;i<n;i++){list.push(elem);}return Object.freeze(list);}function mapfoldl(fun,acc,list){var newlist=[];var _iteratorNormalCompletion14=true;var _didIteratorError14=false;var _iteratorError14=undefined;try{for(var _iterator14=list[Symbol.iterator](),_step14;!(_iteratorNormalCompletion14=(_step14=_iterator14.next()).done);_iteratorNormalCompletion14=true){var _x22=_step14.value;var tup=fun(_x22,acc);newlist.push(tup.get(0));acc=tup.get(1);}}catch(err){_didIteratorError14=true;_iteratorError14=err;}finally {try{if(!_iteratorNormalCompletion14&&_iterator14.return){_iterator14.return();}}finally {if(_didIteratorError14){throw _iteratorError14;}}}return new Tuple(Object.freeze(newlist),acc);}function filtermap(fun,list){var newlist=[];var _iteratorNormalCompletion15=true;var _didIteratorError15=false;var _iteratorError15=undefined;try{for(var _iterator15=list[Symbol.iterator](),_step15;!(_iteratorNormalCompletion15=(_step15=_iterator15.next()).done);_iteratorNormalCompletion15=true){x=_step15.value;var result=fun(x);if(result===true){newlist.push(x);}else if(result instanceof Tuple){newlist.push(result.get(1));}}}catch(err){_didIteratorError15=true;_iteratorError15=err;}finally {try{if(!_iteratorNormalCompletion15&&_iterator15.return){_iterator15.return();}}finally {if(_didIteratorError15){throw _iteratorError15;}}}return Object.freeze(newlist);}function maps_fold(fun,acc,map){var acc1=acc;var _iteratorNormalCompletion16=true;var _didIteratorError16=false;var _iteratorError16=undefined;try{for(var _iterator16=get_object_keys(map)[Symbol.iterator](),_step16;!(_iteratorNormalCompletion16=(_step16=_iterator16.next()).done);_iteratorNormalCompletion16=true){var k=_step16.value;acc1=fun(k,map[k],acc1);}}catch(err){_didIteratorError16=true;_iteratorError16=err;}finally {try{if(!_iteratorNormalCompletion16&&_iterator16.return){_iterator16.return();}}finally {if(_didIteratorError16){throw _iteratorError16;}}}return acc1;}var Functions={call_property:call_property,apply:apply,contains:contains,get_global:get_global,defstruct:defstruct,defexception:defexception,defprotocol:defprotocol,defimpl:defimpl,get_object_keys:get_object_keys,is_valid_character:is_valid_character,b64EncodeUnicode:b64EncodeUnicode,delete_property_from_map:delete_property_from_map,add_property_to_map:add_property_to_map,class_to_obj:class_to_obj,can_decode64:can_decode64,bnot:bnot,band:band,bor:bor,bsl:bsl,bsr:bsr,bxor:bxor,zip:zip,foldl:foldl,foldr:foldr,remove_from_list:remove_from_list,keydelete:keydelete,keystore:keystore,keyfind:keyfind,keytake:keytake,keyreplace:keyreplace,reverse:reverse,update_map:update_map,maps_find:maps_find,flatten:flatten,duplicate:duplicate,mapfoldl:mapfoldl,filtermap:filtermap,maps_fold:maps_fold};function _case(condition,clauses){return Patterns.defmatch.apply(Patterns,_toConsumableArray(clauses))(condition);}function cond(clauses){var _iteratorNormalCompletion17=true;var _didIteratorError17=false;var _iteratorError17=undefined;try{for(var _iterator17=clauses[Symbol.iterator](),_step17;!(_iteratorNormalCompletion17=(_step17=_iterator17.next()).done);_iteratorNormalCompletion17=true){var clause=_step17.value;if(clause[0]){return clause[1]();}}}catch(err){_didIteratorError17=true;_iteratorError17=err;}finally {try{if(!_iteratorNormalCompletion17&&_iterator17.return){_iterator17.return();}}finally {if(_didIteratorError17){throw _iteratorError17;}}}throw new Error();}function map_update(map,values){return Object.freeze(Object.assign(Object.create(map.constructor.prototype),map,values));}function _for(collections,fun){var filter=arguments.length<=2||arguments[2]===undefined?function(){return true;}:arguments[2];var into=arguments.length<=3||arguments[3]===undefined?[]:arguments[3];var previousValues=arguments.length<=4||arguments[4]===undefined?[]:arguments[4];var pattern=collections[0][0];var collection=collections[0][1];if(collections.length===1){if(collection instanceof BitString){var bsSlice=collection.slice(0,pattern.byte_size());var i=1;while(bsSlice.byte_size==pattern.byte_size()){var r=Patterns.match_no_throw(pattern,bsSlice);var args=previousValues.concat(r);if(r&&filter.apply(this,args)){into=into.concat([fun.apply(this,args)]);}bsSlice=collection.slice(pattern.byte_size()*i,pattern.byte_size()*(i+1));i++;}return into;}else {var _iteratorNormalCompletion18=true;var _didIteratorError18=false;var _iteratorError18=undefined;try{for(var _iterator18=collection[Symbol.iterator](),_step18;!(_iteratorNormalCompletion18=(_step18=_iterator18.next()).done);_iteratorNormalCompletion18=true){var _elem=_step18.value;var r=Patterns.match_no_throw(pattern,_elem);var args=previousValues.concat(r);if(r&&filter.apply(this,args)){into=into.concat([fun.apply(this,args)]);}}}catch(err){_didIteratorError18=true;_iteratorError18=err;}finally {try{if(!_iteratorNormalCompletion18&&_iterator18.return){_iterator18.return();}}finally {if(_didIteratorError18){throw _iteratorError18;}}}return into;}}else {var _into=[];if(collection instanceof BitString){var bsSlice=collection.slice(0,pattern.byte_size());var i=1;while(bsSlice.byte_size==pattern.byte_size()){var r=Patterns.match_no_throw(pattern,bsSlice);if(r){_into=into.concat(this._for(collections.slice(1),fun,filter,_into,previousValues.concat(r)));}bsSlice=collection.slice(pattern.byte_size()*i,pattern.byte_size()*(i+1));i++;}}else {var _iteratorNormalCompletion19=true;var _didIteratorError19=false;var _iteratorError19=undefined;try{for(var _iterator19=collection[Symbol.iterator](),_step19;!(_iteratorNormalCompletion19=(_step19=_iterator19.next()).done);_iteratorNormalCompletion19=true){var _elem2=_step19.value;var r=Patterns.match_no_throw(pattern,_elem2);if(r){_into=into.concat(this._for(collections.slice(1),fun,filter,_into,previousValues.concat(r)));}}}catch(err){_didIteratorError19=true;_iteratorError19=err;}finally {try{if(!_iteratorNormalCompletion19&&_iterator19.return){_iterator19.return();}}finally {if(_didIteratorError19){throw _iteratorError19;}}}}return _into;}}function _try(do_fun,rescue_function,catch_fun,else_function,after_function){var result=null;try{result=do_fun();}catch(e){var ex_result=null;if(rescue_function){try{ex_result=rescue_function(e);return ex_result;}catch(ex){if(ex instanceof Patterns.MatchError){throw ex;}}}if(catch_fun){try{ex_result=catch_fun(e);return ex_result;}catch(ex){if(ex instanceof Patterns.MatchError){throw ex;}}}throw e;}finally {if(after_function){after_function();}}if(else_function){try{return else_function(result);}catch(ex){if(ex instanceof Patterns.MatchError){throw new Error("No Match Found in Else");}throw ex;}}else {return result;}}function _with(){var argsToPass=[];for(var i=0;i<arguments.length;i++){if(i===arguments.length-1){return (arguments.length<=i+0?undefined:arguments[i+0]).apply(null,argsToPass);}else {var _ref2=arguments.length<=i+0?undefined:arguments[i+0];var _ref3=_slicedToArray(_ref2,2);var pattern=_ref3[0];var func=_ref3[1];var result=func.apply(null,argsToPass);var patternResult=Patterns.match_no_throw(pattern,result);if(patternResult==null){return result;}else {argsToPass=argsToPass.concat(patternResult);}}}return null;}var SpecialForms$1={_case:_case,cond:cond,map_update:map_update,_for:_for,_try:_try,_with:_with};Functions.get_global().processes=Functions.get_global().processes||new ProcessSystem();var Core={ProcessSystem:ProcessSystem,Tuple:Tuple,PID:PID,BitString:BitString,Patterns:Patterns,Integer:Integer,Float:Float,Functions:Functions,SpecialForms:SpecialForms$1};var Enum={all__qmark__:function all__qmark__(collection){var fun=arguments.length<=1||arguments[1]===undefined?function(x){return x;}:arguments[1];var _iteratorNormalCompletion20=true;var _didIteratorError20=false;var _iteratorError20=undefined;try{for(var _iterator20=collection[Symbol.iterator](),_step20;!(_iteratorNormalCompletion20=(_step20=_iterator20.next()).done);_iteratorNormalCompletion20=true){var _elem3=_step20.value;if(!fun(_elem3)){return false;}}}catch(err){_didIteratorError20=true;_iteratorError20=err;}finally {try{if(!_iteratorNormalCompletion20&&_iterator20.return){_iterator20.return();}}finally {if(_didIteratorError20){throw _iteratorError20;}}}return true;},any__qmark__:function any__qmark__(collection){var fun=arguments.length<=1||arguments[1]===undefined?function(x){return x;}:arguments[1];var _iteratorNormalCompletion21=true;var _didIteratorError21=false;var _iteratorError21=undefined;try{for(var _iterator21=collection[Symbol.iterator](),_step21;!(_iteratorNormalCompletion21=(_step21=_iterator21.next()).done);_iteratorNormalCompletion21=true){var _elem4=_step21.value;if(fun(_elem4)){return true;}}}catch(err){_didIteratorError21=true;_iteratorError21=err;}finally {try{if(!_iteratorNormalCompletion21&&_iterator21.return){_iterator21.return();}}finally {if(_didIteratorError21){throw _iteratorError21;}}}return false;},at:function at(collection,n){var the_default=arguments.length<=2||arguments[2]===undefined?null:arguments[2];if(n>this.count(collection)||n<0){return the_default;}return collection[n];},concat:function concat(){return (arguments.length<=0?undefined:arguments[0]).concat(arguments.length<=1?undefined:arguments[1]);},count:function count(collection){var fun=arguments.length<=1||arguments[1]===undefined?null:arguments[1];if(fun==null){return collection.length;}else {return collection.filter(fun).length;}},drop:function drop(collection,count){return collection.slice(count);},drop_while:function drop_while(collection,fun){var count=0;var _iteratorNormalCompletion22=true;var _didIteratorError22=false;var _iteratorError22=undefined;try{for(var _iterator22=collection[Symbol.iterator](),_step22;!(_iteratorNormalCompletion22=(_step22=_iterator22.next()).done);_iteratorNormalCompletion22=true){var _elem5=_step22.value;if(fun(_elem5)){count=count+1;}else {break;}}}catch(err){_didIteratorError22=true;_iteratorError22=err;}finally {try{if(!_iteratorNormalCompletion22&&_iterator22.return){_iterator22.return();}}finally {if(_didIteratorError22){throw _iteratorError22;}}}return collection.slice(count);},each:function each(collection,fun){var _iteratorNormalCompletion23=true;var _didIteratorError23=false;var _iteratorError23=undefined;try{for(var _iterator23=collection[Symbol.iterator](),_step23;!(_iteratorNormalCompletion23=(_step23=_iterator23.next()).done);_iteratorNormalCompletion23=true){var _elem6=_step23.value;fun(_elem6);}}catch(err){_didIteratorError23=true;_iteratorError23=err;}finally {try{if(!_iteratorNormalCompletion23&&_iterator23.return){_iterator23.return();}}finally {if(_didIteratorError23){throw _iteratorError23;}}}},empty__qmark__:function empty__qmark__(collection){return collection.length===0;},fetch:function fetch(collection,n){if(Array.isArray(collection)){if(n<this.count(collection)&&n>=0){return new Core.Tuple(Symbol.for("ok"),collection[n]);}else {return Symbol.for("error");}}throw new Error("collection is not an Enumerable");},fetch__emark__:function fetch__emark__(collection,n){if(Array.isArray(collection)){if(n<this.count(collection)&&n>=0){return collection[n];}else {throw new Error("out of bounds error");}}throw new Error("collection is not an Enumerable");},filter:function filter(collection,fun){var result=[];var _iteratorNormalCompletion24=true;var _didIteratorError24=false;var _iteratorError24=undefined;try{for(var _iterator24=collection[Symbol.iterator](),_step24;!(_iteratorNormalCompletion24=(_step24=_iterator24.next()).done);_iteratorNormalCompletion24=true){var _elem7=_step24.value;if(fun(_elem7)){result.push(_elem7);}}}catch(err){_didIteratorError24=true;_iteratorError24=err;}finally {try{if(!_iteratorNormalCompletion24&&_iterator24.return){_iterator24.return();}}finally {if(_didIteratorError24){throw _iteratorError24;}}}return result;},filter_map:function filter_map(collection,filter,mapper){return Enum.map(Enum.filter(collection,filter),mapper);},find:function find(collection){var if_none=arguments.length<=1||arguments[1]===undefined?null:arguments[1];var fun=arguments[2];var _iteratorNormalCompletion25=true;var _didIteratorError25=false;var _iteratorError25=undefined;try{for(var _iterator25=collection[Symbol.iterator](),_step25;!(_iteratorNormalCompletion25=(_step25=_iterator25.next()).done);_iteratorNormalCompletion25=true){var _elem8=_step25.value;if(fun(_elem8)){return _elem8;}}}catch(err){_didIteratorError25=true;_iteratorError25=err;}finally {try{if(!_iteratorNormalCompletion25&&_iterator25.return){_iterator25.return();}}finally {if(_didIteratorError25){throw _iteratorError25;}}}return if_none;},into:function into(collection,list){return list.concat(collection);},map:function map(collection,fun){var result=[];var _iteratorNormalCompletion26=true;var _didIteratorError26=false;var _iteratorError26=undefined;try{for(var _iterator26=collection[Symbol.iterator](),_step26;!(_iteratorNormalCompletion26=(_step26=_iterator26.next()).done);_iteratorNormalCompletion26=true){var _elem9=_step26.value;result.push(fun(_elem9));}}catch(err){_didIteratorError26=true;_iteratorError26=err;}finally {try{if(!_iteratorNormalCompletion26&&_iterator26.return){_iterator26.return();}}finally {if(_didIteratorError26){throw _iteratorError26;}}}return result;},map_reduce:function map_reduce(collection,acc,fun){var mapped=Object.freeze([]);var the_acc=acc;for(var i=0;i<this.count(collection);i++){var tuple=fun(collection[i],the_acc);the_acc=tuple.get(1);mapped=Object.freeze(mapped.concat([tuple.get(0)]));}return new Core.Tuple(mapped,the_acc);},member__qmark__:function member__qmark__(collection,value){return collection.includes(value);},reduce:function reduce(collection,acc,fun){var the_acc=acc;for(var i=0;i<this.count(collection);i++){var tuple=fun(collection[i],the_acc);the_acc=tuple.get(1);}return the_acc;},take:function take(collection,count){return collection.slice(0,count);},take_every:function take_every(collection,nth){var result=[];var index=0;var _iteratorNormalCompletion27=true;var _didIteratorError27=false;var _iteratorError27=undefined;try{for(var _iterator27=collection[Symbol.iterator](),_step27;!(_iteratorNormalCompletion27=(_step27=_iterator27.next()).done);_iteratorNormalCompletion27=true){var _elem10=_step27.value;if(index%nth===0){result.push(_elem10);}}}catch(err){_didIteratorError27=true;_iteratorError27=err;}finally {try{if(!_iteratorNormalCompletion27&&_iterator27.return){_iterator27.return();}}finally {if(_didIteratorError27){throw _iteratorError27;}}}return Object.freeze(result);},take_while:function take_while(collection,fun){var count=0;var _iteratorNormalCompletion28=true;var _didIteratorError28=false;var _iteratorError28=undefined;try{for(var _iterator28=collection[Symbol.iterator](),_step28;!(_iteratorNormalCompletion28=(_step28=_iterator28.next()).done);_iteratorNormalCompletion28=true){var _elem11=_step28.value;if(fun(_elem11)){count=count+1;}else {break;}}}catch(err){_didIteratorError28=true;_iteratorError28=err;}finally {try{if(!_iteratorNormalCompletion28&&_iterator28.return){_iterator28.return();}}finally {if(_didIteratorError28){throw _iteratorError28;}}}return collection.slice(0,count);},to_list:function to_list(collection){return collection;}};var VirtualDOM=function(e){return e();}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f;}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e);},l,l.exports,e,t,n,r);}return n[o].exports;}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++){s(r[o]);}return s;}({1:[function(require,module,exports){var createElement=require("./vdom/create-element.js");module.exports=createElement;},{"./vdom/create-element.js":15}],2:[function(require,module,exports){var diff=require("./vtree/diff.js");module.exports=diff;},{"./vtree/diff.js":35}],3:[function(require,module,exports){var h=require("./virtual-hyperscript/index.js");module.exports=h;},{"./virtual-hyperscript/index.js":22}],4:[function(require,module,exports){var diff=require("./diff.js");var patch=require("./patch.js");var h=require("./h.js");var create=require("./create-element.js");var VNode=require('./vnode/vnode.js');var VText=require('./vnode/vtext.js');module.exports={diff:diff,patch:patch,h:h,create:create,VNode:VNode,VText:VText};},{"./create-element.js":1,"./diff.js":2,"./h.js":3,"./patch.js":13,"./vnode/vnode.js":31,"./vnode/vtext.js":33}],5:[function(require,module,exports){ /*!
             * Cross-Browser Split 1.1.1
             * Copyright 2007-2012 Steven Levithan <stevenlevithan.com>
             * Available under the MIT License
             * ECMAScript compliant, uniform cross-browser split method
             */ /**
             * Splits a string into an array of strings using a regex or string separator. Matches of the
             * separator are not included in the result array. However, if `separator` is a regex that contains
             * capturing groups, backreferences are spliced into the result each time `separator` is matched.
             * Fixes browser bugs compared to the native `String.prototype.split` and can be used reliably
             * cross-browser.
             * @param {String} str String to split.
             * @param {RegExp|String} separator Regex or string to use for separating the string.
             * @param {Number} [limit] Maximum number of items to include in the result array.
             * @returns {Array} Array of substrings.
             * @example
             *
             * // Basic use
             * split('a b c d', ' ');
             * // -> ['a', 'b', 'c', 'd']
             *
             * // With limit
             * split('a b c d', ' ', 2);
             * // -> ['a', 'b']
             *
             * // Backreferences in result array
             * split('..word1 word2..', /([a-z]+)(\d+)/i);
             * // -> ['..', 'word', '1', ' ', 'word', '2', '..']
             */module.exports=function split(undef){var nativeSplit=String.prototype.split,compliantExecNpcg=/()??/.exec("")[1]===undef, // NPCG: nonparticipating capturing group
self;self=function self(str,separator,limit){ // If `separator` is not a regex, use `nativeSplit`
if(Object.prototype.toString.call(separator)!=="[object RegExp]"){return nativeSplit.call(str,separator,limit);}var output=[],flags=(separator.ignoreCase?"i":"")+(separator.multiline?"m":"")+(separator.extended?"x":"")+( // Proposed for ES6
separator.sticky?"y":""), // Firefox 3+
lastLastIndex=0, // Make `global` and avoid `lastIndex` issues by working with a copy
separator=new RegExp(separator.source,flags+"g"),separator2,match,lastIndex,lastLength;str+=""; // Type-convert
if(!compliantExecNpcg){ // Doesn't need flags gy, but they don't hurt
separator2=new RegExp("^"+separator.source+"$(?!\\s)",flags);} /* Values for `limit`, per the spec:
                     * If undefined: 4294967295 // Math.pow(2, 32) - 1
                     * If 0, Infinity, or NaN: 0
                     * If positive number: limit = Math.floor(limit); if (limit > 4294967295) limit -= 4294967296;
                     * If negative number: 4294967296 - Math.floor(Math.abs(limit))
                     * If other: Type-convert, then use the above rules
                     */limit=limit===undef?-1>>>0: // Math.pow(2, 32) - 1
limit>>>0; // ToUint32(limit)
while(match=separator.exec(str)){ // `separator.lastIndex` is not reliable cross-browser
lastIndex=match.index+match[0].length;if(lastIndex>lastLastIndex){output.push(str.slice(lastLastIndex,match.index)); // Fix browsers whose `exec` methods don't consistently return `undefined` for
// nonparticipating capturing groups
if(!compliantExecNpcg&&match.length>1){match[0].replace(separator2,function(){for(var i=1;i<arguments.length-2;i++){if(arguments[i]===undef){match[i]=undef;}}});}if(match.length>1&&match.index<str.length){Array.prototype.push.apply(output,match.slice(1));}lastLength=match[0].length;lastLastIndex=lastIndex;if(output.length>=limit){break;}}if(separator.lastIndex===match.index){separator.lastIndex++; // Avoid an infinite loop
}}if(lastLastIndex===str.length){if(lastLength||!separator.test("")){output.push("");}}else {output.push(str.slice(lastLastIndex));}return output.length>limit?output.slice(0,limit):output;};return self;}();},{}],6:[function(require,module,exports){},{}],7:[function(require,module,exports){'use strict';var OneVersionConstraint=require('individual/one-version');var MY_VERSION='7';OneVersionConstraint('ev-store',MY_VERSION);var hashKey='__EV_STORE_KEY@'+MY_VERSION;module.exports=EvStore;function EvStore(elem){var hash=elem[hashKey];if(!hash){hash=elem[hashKey]={};}return hash;}},{"individual/one-version":9}],8:[function(require,module,exports){(function(global){'use strict'; /*global window, global*/var root=typeof window!=='undefined'?window:typeof global!=='undefined'?global:{};module.exports=Individual;function Individual(key,value){if(key in root){return root[key];}root[key]=value;return value;}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{});},{}],9:[function(require,module,exports){'use strict';var Individual=require('./index.js');module.exports=OneVersion;function OneVersion(moduleName,version,defaultValue){var key='__INDIVIDUAL_ONE_VERSION_'+moduleName;var enforceKey=key+'_ENFORCE_SINGLETON';var versionValue=Individual(enforceKey,version);if(versionValue!==version){throw new Error('Can only have one copy of '+moduleName+'.\n'+'You already have version '+versionValue+' installed.\n'+'This means you cannot install version '+version);}return Individual(key,defaultValue);}},{"./index.js":8}],10:[function(require,module,exports){(function(global){var topLevel=typeof global!=='undefined'?global:typeof window!=='undefined'?window:{};var minDoc=require('min-document');if(typeof document!=='undefined'){module.exports=document;}else {var doccy=topLevel['__GLOBAL_DOCUMENT_CACHE@4'];if(!doccy){doccy=topLevel['__GLOBAL_DOCUMENT_CACHE@4']=minDoc;}module.exports=doccy;}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{});},{"min-document":6}],11:[function(require,module,exports){"use strict";module.exports=function isObject(x){return (typeof x==="undefined"?"undefined":_typeof(x))==="object"&&x!==null;};},{}],12:[function(require,module,exports){var nativeIsArray=Array.isArray;var toString=Object.prototype.toString;module.exports=nativeIsArray||isArray;function isArray(obj){return toString.call(obj)==="[object Array]";}},{}],13:[function(require,module,exports){var patch=require("./vdom/patch.js");module.exports=patch;},{"./vdom/patch.js":18}],14:[function(require,module,exports){var isObject=require("is-object");var isHook=require("../vnode/is-vhook.js");module.exports=applyProperties;function applyProperties(node,props,previous){for(var propName in props){var propValue=props[propName];if(propValue===undefined){removeProperty(node,propName,propValue,previous);}else if(isHook(propValue)){removeProperty(node,propName,propValue,previous);if(propValue.hook){propValue.hook(node,propName,previous?previous[propName]:undefined);}}else {if(isObject(propValue)){patchObject(node,props,previous,propName,propValue);}else {node[propName]=propValue;}}}}function removeProperty(node,propName,propValue,previous){if(previous){var previousValue=previous[propName];if(!isHook(previousValue)){if(propName==="attributes"){for(var attrName in previousValue){node.removeAttribute(attrName);}}else if(propName==="style"){for(var i in previousValue){node.style[i]="";}}else if(typeof previousValue==="string"){node[propName]="";}else {node[propName]=null;}}else if(previousValue.unhook){previousValue.unhook(node,propName,propValue);}}}function patchObject(node,props,previous,propName,propValue){var previousValue=previous?previous[propName]:undefined; // Set attributes
if(propName==="attributes"){for(var attrName in propValue){var attrValue=propValue[attrName];if(attrValue===undefined){node.removeAttribute(attrName);}else {node.setAttribute(attrName,attrValue);}}return;}if(previousValue&&isObject(previousValue)&&getPrototype(previousValue)!==getPrototype(propValue)){node[propName]=propValue;return;}if(!isObject(node[propName])){node[propName]={};}var replacer=propName==="style"?"":undefined;for(var k in propValue){var value=propValue[k];node[propName][k]=value===undefined?replacer:value;}}function getPrototype(value){if(Object.getPrototypeOf){return Object.getPrototypeOf(value);}else if(value.__proto__){return value.__proto__;}else if(value.constructor){return value.constructor.prototype;}}},{"../vnode/is-vhook.js":26,"is-object":11}],15:[function(require,module,exports){var document=require("global/document");var applyProperties=require("./apply-properties");var isVNode=require("../vnode/is-vnode.js");var isVText=require("../vnode/is-vtext.js");var isWidget=require("../vnode/is-widget.js");var handleThunk=require("../vnode/handle-thunk.js");module.exports=createElement;function createElement(vnode,opts){var doc=opts?opts.document||document:document;var warn=opts?opts.warn:null;vnode=handleThunk(vnode).a;if(isWidget(vnode)){return vnode.init();}else if(isVText(vnode)){return doc.createTextNode(vnode.text);}else if(!isVNode(vnode)){if(warn){warn("Item is not a valid virtual dom node",vnode);}return null;}var node=vnode.namespace===null?doc.createElement(vnode.tagName):doc.createElementNS(vnode.namespace,vnode.tagName);var props=vnode.properties;applyProperties(node,props);var children=vnode.children;for(var i=0;i<children.length;i++){var childNode=createElement(children[i],opts);if(childNode){node.appendChild(childNode);}}return node;}},{"../vnode/handle-thunk.js":24,"../vnode/is-vnode.js":27,"../vnode/is-vtext.js":28,"../vnode/is-widget.js":29,"./apply-properties":14,"global/document":10}],16:[function(require,module,exports){ // Maps a virtual DOM tree onto a real DOM tree in an efficient manner.
// We don't want to read all of the DOM nodes in the tree so we use
// the in-order tree indexing to eliminate recursion down certain branches.
// We only recurse into a DOM node if we know that it contains a child of
// interest.
var noChild={};module.exports=domIndex;function domIndex(rootNode,tree,indices,nodes){if(!indices||indices.length===0){return {};}else {indices.sort(ascending);return recurse(rootNode,tree,indices,nodes,0);}}function recurse(rootNode,tree,indices,nodes,rootIndex){nodes=nodes||{};if(rootNode){if(indexInRange(indices,rootIndex,rootIndex)){nodes[rootIndex]=rootNode;}var vChildren=tree.children;if(vChildren){var childNodes=rootNode.childNodes;for(var i=0;i<tree.children.length;i++){rootIndex+=1;var vChild=vChildren[i]||noChild;var nextIndex=rootIndex+(vChild.count||0); // skip recursion down the tree if there are no nodes down here
if(indexInRange(indices,rootIndex,nextIndex)){recurse(childNodes[i],vChild,indices,nodes,rootIndex);}rootIndex=nextIndex;}}}return nodes;} // Binary search for an index in the interval [left, right]
function indexInRange(indices,left,right){if(indices.length===0){return false;}var minIndex=0;var maxIndex=indices.length-1;var currentIndex;var currentItem;while(minIndex<=maxIndex){currentIndex=(maxIndex+minIndex)/2>>0;currentItem=indices[currentIndex];if(minIndex===maxIndex){return currentItem>=left&&currentItem<=right;}else if(currentItem<left){minIndex=currentIndex+1;}else if(currentItem>right){maxIndex=currentIndex-1;}else {return true;}}return false;}function ascending(a,b){return a>b?1:-1;}},{}],17:[function(require,module,exports){var applyProperties=require("./apply-properties");var isWidget=require("../vnode/is-widget.js");var VPatch=require("../vnode/vpatch.js");var updateWidget=require("./update-widget");module.exports=applyPatch;function applyPatch(vpatch,domNode,renderOptions){var type=vpatch.type;var vNode=vpatch.vNode;var patch=vpatch.patch;switch(type){case VPatch.REMOVE:return removeNode(domNode,vNode);case VPatch.INSERT:return insertNode(domNode,patch,renderOptions);case VPatch.VTEXT:return stringPatch(domNode,vNode,patch,renderOptions);case VPatch.WIDGET:return widgetPatch(domNode,vNode,patch,renderOptions);case VPatch.VNODE:return vNodePatch(domNode,vNode,patch,renderOptions);case VPatch.ORDER:reorderChildren(domNode,patch);return domNode;case VPatch.PROPS:applyProperties(domNode,patch,vNode.properties);return domNode;case VPatch.THUNK:return replaceRoot(domNode,renderOptions.patch(domNode,patch,renderOptions));default:return domNode;}}function removeNode(domNode,vNode){var parentNode=domNode.parentNode;if(parentNode){parentNode.removeChild(domNode);}destroyWidget(domNode,vNode);return null;}function insertNode(parentNode,vNode,renderOptions){var newNode=renderOptions.render(vNode,renderOptions);if(parentNode){parentNode.appendChild(newNode);}return parentNode;}function stringPatch(domNode,leftVNode,vText,renderOptions){var newNode;if(domNode.nodeType===3){domNode.replaceData(0,domNode.length,vText.text);newNode=domNode;}else {var parentNode=domNode.parentNode;newNode=renderOptions.render(vText,renderOptions);if(parentNode&&newNode!==domNode){parentNode.replaceChild(newNode,domNode);}}return newNode;}function widgetPatch(domNode,leftVNode,widget,renderOptions){var updating=updateWidget(leftVNode,widget);var newNode;if(updating){newNode=widget.update(leftVNode,domNode)||domNode;}else {newNode=renderOptions.render(widget,renderOptions);}var parentNode=domNode.parentNode;if(parentNode&&newNode!==domNode){parentNode.replaceChild(newNode,domNode);}if(!updating){destroyWidget(domNode,leftVNode);}return newNode;}function vNodePatch(domNode,leftVNode,vNode,renderOptions){var parentNode=domNode.parentNode;var newNode=renderOptions.render(vNode,renderOptions);if(parentNode&&newNode!==domNode){parentNode.replaceChild(newNode,domNode);}return newNode;}function destroyWidget(domNode,w){if(typeof w.destroy==="function"&&isWidget(w)){w.destroy(domNode);}}function reorderChildren(domNode,moves){var childNodes=domNode.childNodes;var keyMap={};var node;var remove;var insert;for(var i=0;i<moves.removes.length;i++){remove=moves.removes[i];node=childNodes[remove.from];if(remove.key){keyMap[remove.key]=node;}domNode.removeChild(node);}var length=childNodes.length;for(var j=0;j<moves.inserts.length;j++){insert=moves.inserts[j];node=keyMap[insert.key]; // this is the weirdest bug i've ever seen in webkit
domNode.insertBefore(node,insert.to>=length++?null:childNodes[insert.to]);}}function replaceRoot(oldRoot,newRoot){if(oldRoot&&newRoot&&oldRoot!==newRoot&&oldRoot.parentNode){oldRoot.parentNode.replaceChild(newRoot,oldRoot);}return newRoot;}},{"../vnode/is-widget.js":29,"../vnode/vpatch.js":32,"./apply-properties":14,"./update-widget":19}],18:[function(require,module,exports){var document=require("global/document");var isArray=require("x-is-array");var render=require("./create-element");var domIndex=require("./dom-index");var patchOp=require("./patch-op");module.exports=patch;function patch(rootNode,patches,renderOptions){renderOptions=renderOptions||{};renderOptions.patch=renderOptions.patch&&renderOptions.patch!==patch?renderOptions.patch:patchRecursive;renderOptions.render=renderOptions.render||render;return renderOptions.patch(rootNode,patches,renderOptions);}function patchRecursive(rootNode,patches,renderOptions){var indices=patchIndices(patches);if(indices.length===0){return rootNode;}var index=domIndex(rootNode,patches.a,indices);var ownerDocument=rootNode.ownerDocument;if(!renderOptions.document&&ownerDocument!==document){renderOptions.document=ownerDocument;}for(var i=0;i<indices.length;i++){var nodeIndex=indices[i];rootNode=applyPatch(rootNode,index[nodeIndex],patches[nodeIndex],renderOptions);}return rootNode;}function applyPatch(rootNode,domNode,patchList,renderOptions){if(!domNode){return rootNode;}var newNode;if(isArray(patchList)){for(var i=0;i<patchList.length;i++){newNode=patchOp(patchList[i],domNode,renderOptions);if(domNode===rootNode){rootNode=newNode;}}}else {newNode=patchOp(patchList,domNode,renderOptions);if(domNode===rootNode){rootNode=newNode;}}return rootNode;}function patchIndices(patches){var indices=[];for(var key in patches){if(key!=="a"){indices.push(Number(key));}}return indices;}},{"./create-element":15,"./dom-index":16,"./patch-op":17,"global/document":10,"x-is-array":12}],19:[function(require,module,exports){var isWidget=require("../vnode/is-widget.js");module.exports=updateWidget;function updateWidget(a,b){if(isWidget(a)&&isWidget(b)){if("name" in a&&"name" in b){return a.id===b.id;}else {return a.init===b.init;}}return false;}},{"../vnode/is-widget.js":29}],20:[function(require,module,exports){'use strict';var EvStore=require('ev-store');module.exports=EvHook;function EvHook(value){if(!(this instanceof EvHook)){return new EvHook(value);}this.value=value;}EvHook.prototype.hook=function(node,propertyName){var es=EvStore(node);var propName=propertyName.substr(3);es[propName]=this.value;};EvHook.prototype.unhook=function(node,propertyName){var es=EvStore(node);var propName=propertyName.substr(3);es[propName]=undefined;};},{"ev-store":7}],21:[function(require,module,exports){'use strict';module.exports=SoftSetHook;function SoftSetHook(value){if(!(this instanceof SoftSetHook)){return new SoftSetHook(value);}this.value=value;}SoftSetHook.prototype.hook=function(node,propertyName){if(node[propertyName]!==this.value){node[propertyName]=this.value;}};},{}],22:[function(require,module,exports){'use strict';var isArray=require('x-is-array');var VNode=require('../vnode/vnode.js');var VText=require('../vnode/vtext.js');var isVNode=require('../vnode/is-vnode');var isVText=require('../vnode/is-vtext');var isWidget=require('../vnode/is-widget');var isHook=require('../vnode/is-vhook');var isVThunk=require('../vnode/is-thunk');var parseTag=require('./parse-tag.js');var softSetHook=require('./hooks/soft-set-hook.js');var evHook=require('./hooks/ev-hook.js');module.exports=h;function h(tagName,properties,children){var childNodes=[];var tag,props,key,namespace;if(!children&&isChildren(properties)){children=properties;props={};}props=props||properties||{};tag=parseTag(tagName,props); // support keys
if(props.hasOwnProperty('key')){key=props.key;props.key=undefined;} // support namespace
if(props.hasOwnProperty('namespace')){namespace=props.namespace;props.namespace=undefined;} // fix cursor bug
if(tag==='INPUT'&&!namespace&&props.hasOwnProperty('value')&&props.value!==undefined&&!isHook(props.value)){props.value=softSetHook(props.value);}transformProperties(props);if(children!==undefined&&children!==null){addChild(children,childNodes,tag,props);}return new VNode(tag,props,childNodes,key,namespace);}function addChild(c,childNodes,tag,props){if(typeof c==='string'){childNodes.push(new VText(c));}else if(typeof c==='number'){childNodes.push(new VText(String(c)));}else if(isChild(c)){childNodes.push(c);}else if(isArray(c)){for(var i=0;i<c.length;i++){addChild(c[i],childNodes,tag,props);}}else if(c===null||c===undefined){return;}else {throw UnexpectedVirtualElement({foreignObject:c,parentVnode:{tagName:tag,properties:props}});}}function transformProperties(props){for(var propName in props){if(props.hasOwnProperty(propName)){var value=props[propName];if(isHook(value)){continue;}if(propName.substr(0,3)==='ev-'){ // add ev-foo support
props[propName]=evHook(value);}}}}function isChild(x){return isVNode(x)||isVText(x)||isWidget(x)||isVThunk(x);}function isChildren(x){return typeof x==='string'||isArray(x)||isChild(x);}function UnexpectedVirtualElement(data){var err=new Error();err.type='virtual-hyperscript.unexpected.virtual-element';err.message='Unexpected virtual child passed to h().\n'+'Expected a VNode / Vthunk / VWidget / string but:\n'+'got:\n'+errorString(data.foreignObject)+'.\n'+'The parent vnode is:\n'+errorString(data.parentVnode);'\n'+'Suggested fix: change your `h(..., [ ... ])` callsite.';err.foreignObject=data.foreignObject;err.parentVnode=data.parentVnode;return err;}function errorString(obj){try{return JSON.stringify(obj,null,'    ');}catch(e){return String(obj);}}},{"../vnode/is-thunk":25,"../vnode/is-vhook":26,"../vnode/is-vnode":27,"../vnode/is-vtext":28,"../vnode/is-widget":29,"../vnode/vnode.js":31,"../vnode/vtext.js":33,"./hooks/ev-hook.js":20,"./hooks/soft-set-hook.js":21,"./parse-tag.js":23,"x-is-array":12}],23:[function(require,module,exports){'use strict';var split=require('browser-split');var classIdSplit=/([\.#]?[a-zA-Z0-9\u007F-\uFFFF_:-]+)/;var notClassId=/^\.|#/;module.exports=parseTag;function parseTag(tag,props){if(!tag){return 'DIV';}var noId=!props.hasOwnProperty('id');var tagParts=split(tag,classIdSplit);var tagName=null;if(notClassId.test(tagParts[1])){tagName='DIV';}var classes,part,type,i;for(i=0;i<tagParts.length;i++){part=tagParts[i];if(!part){continue;}type=part.charAt(0);if(!tagName){tagName=part;}else if(type==='.'){classes=classes||[];classes.push(part.substring(1,part.length));}else if(type==='#'&&noId){props.id=part.substring(1,part.length);}}if(classes){if(props.className){classes.push(props.className);}props.className=classes.join(' ');}return props.namespace?tagName:tagName.toUpperCase();}},{"browser-split":5}],24:[function(require,module,exports){var isVNode=require("./is-vnode");var isVText=require("./is-vtext");var isWidget=require("./is-widget");var isThunk=require("./is-thunk");module.exports=handleThunk;function handleThunk(a,b){var renderedA=a;var renderedB=b;if(isThunk(b)){renderedB=renderThunk(b,a);}if(isThunk(a)){renderedA=renderThunk(a,null);}return {a:renderedA,b:renderedB};}function renderThunk(thunk,previous){var renderedThunk=thunk.vnode;if(!renderedThunk){renderedThunk=thunk.vnode=thunk.render(previous);}if(!(isVNode(renderedThunk)||isVText(renderedThunk)||isWidget(renderedThunk))){throw new Error("thunk did not return a valid node");}return renderedThunk;}},{"./is-thunk":25,"./is-vnode":27,"./is-vtext":28,"./is-widget":29}],25:[function(require,module,exports){module.exports=isThunk;function isThunk(t){return t&&t.type==="Thunk";}},{}],26:[function(require,module,exports){module.exports=isHook;function isHook(hook){return hook&&(typeof hook.hook==="function"&&!hook.hasOwnProperty("hook")||typeof hook.unhook==="function"&&!hook.hasOwnProperty("unhook"));}},{}],27:[function(require,module,exports){var version=require("./version");module.exports=isVirtualNode;function isVirtualNode(x){return x&&x.type==="VirtualNode"&&x.version===version;}},{"./version":30}],28:[function(require,module,exports){var version=require("./version");module.exports=isVirtualText;function isVirtualText(x){return x&&x.type==="VirtualText"&&x.version===version;}},{"./version":30}],29:[function(require,module,exports){module.exports=isWidget;function isWidget(w){return w&&w.type==="Widget";}},{}],30:[function(require,module,exports){module.exports="2";},{}],31:[function(require,module,exports){var version=require("./version");var isVNode=require("./is-vnode");var isWidget=require("./is-widget");var isThunk=require("./is-thunk");var isVHook=require("./is-vhook");module.exports=VirtualNode;var noProperties={};var noChildren=[];function VirtualNode(tagName,properties,children,key,namespace){this.tagName=tagName;this.properties=properties||noProperties;this.children=children||noChildren;this.key=key!=null?String(key):undefined;this.namespace=typeof namespace==="string"?namespace:null;var count=children&&children.length||0;var descendants=0;var hasWidgets=false;var hasThunks=false;var descendantHooks=false;var hooks;for(var propName in properties){if(properties.hasOwnProperty(propName)){var property=properties[propName];if(isVHook(property)&&property.unhook){if(!hooks){hooks={};}hooks[propName]=property;}}}for(var i=0;i<count;i++){var child=children[i];if(isVNode(child)){descendants+=child.count||0;if(!hasWidgets&&child.hasWidgets){hasWidgets=true;}if(!hasThunks&&child.hasThunks){hasThunks=true;}if(!descendantHooks&&(child.hooks||child.descendantHooks)){descendantHooks=true;}}else if(!hasWidgets&&isWidget(child)){if(typeof child.destroy==="function"){hasWidgets=true;}}else if(!hasThunks&&isThunk(child)){hasThunks=true;}}this.count=count+descendants;this.hasWidgets=hasWidgets;this.hasThunks=hasThunks;this.hooks=hooks;this.descendantHooks=descendantHooks;}VirtualNode.prototype.version=version;VirtualNode.prototype.type="VirtualNode";},{"./is-thunk":25,"./is-vhook":26,"./is-vnode":27,"./is-widget":29,"./version":30}],32:[function(require,module,exports){var version=require("./version");VirtualPatch.NONE=0;VirtualPatch.VTEXT=1;VirtualPatch.VNODE=2;VirtualPatch.WIDGET=3;VirtualPatch.PROPS=4;VirtualPatch.ORDER=5;VirtualPatch.INSERT=6;VirtualPatch.REMOVE=7;VirtualPatch.THUNK=8;module.exports=VirtualPatch;function VirtualPatch(type,vNode,patch){this.type=Number(type);this.vNode=vNode;this.patch=patch;}VirtualPatch.prototype.version=version;VirtualPatch.prototype.type="VirtualPatch";},{"./version":30}],33:[function(require,module,exports){var version=require("./version");module.exports=VirtualText;function VirtualText(text){this.text=String(text);}VirtualText.prototype.version=version;VirtualText.prototype.type="VirtualText";},{"./version":30}],34:[function(require,module,exports){var isObject=require("is-object");var isHook=require("../vnode/is-vhook");module.exports=diffProps;function diffProps(a,b){var diff;for(var aKey in a){if(!(aKey in b)){diff=diff||{};diff[aKey]=undefined;}var aValue=a[aKey];var bValue=b[aKey];if(aValue===bValue){continue;}else if(isObject(aValue)&&isObject(bValue)){if(getPrototype(bValue)!==getPrototype(aValue)){diff=diff||{};diff[aKey]=bValue;}else if(isHook(bValue)){diff=diff||{};diff[aKey]=bValue;}else {var objectDiff=diffProps(aValue,bValue);if(objectDiff){diff=diff||{};diff[aKey]=objectDiff;}}}else {diff=diff||{};diff[aKey]=bValue;}}for(var bKey in b){if(!(bKey in a)){diff=diff||{};diff[bKey]=b[bKey];}}return diff;}function getPrototype(value){if(Object.getPrototypeOf){return Object.getPrototypeOf(value);}else if(value.__proto__){return value.__proto__;}else if(value.constructor){return value.constructor.prototype;}}},{"../vnode/is-vhook":26,"is-object":11}],35:[function(require,module,exports){var isArray=require("x-is-array");var VPatch=require("../vnode/vpatch");var isVNode=require("../vnode/is-vnode");var isVText=require("../vnode/is-vtext");var isWidget=require("../vnode/is-widget");var isThunk=require("../vnode/is-thunk");var handleThunk=require("../vnode/handle-thunk");var diffProps=require("./diff-props");module.exports=diff;function diff(a,b){var patch={a:a};walk(a,b,patch,0);return patch;}function walk(a,b,patch,index){if(a===b){return;}var apply=patch[index];var applyClear=false;if(isThunk(a)||isThunk(b)){thunks(a,b,patch,index);}else if(b==null){ // If a is a widget we will add a remove patch for it
// Otherwise any child widgets/hooks must be destroyed.
// This prevents adding two remove patches for a widget.
if(!isWidget(a)){clearState(a,patch,index);apply=patch[index];}apply=appendPatch(apply,new VPatch(VPatch.REMOVE,a,b));}else if(isVNode(b)){if(isVNode(a)){if(a.tagName===b.tagName&&a.namespace===b.namespace&&a.key===b.key){var propsPatch=diffProps(a.properties,b.properties);if(propsPatch){apply=appendPatch(apply,new VPatch(VPatch.PROPS,a,propsPatch));}apply=diffChildren(a,b,patch,apply,index);}else {apply=appendPatch(apply,new VPatch(VPatch.VNODE,a,b));applyClear=true;}}else {apply=appendPatch(apply,new VPatch(VPatch.VNODE,a,b));applyClear=true;}}else if(isVText(b)){if(!isVText(a)){apply=appendPatch(apply,new VPatch(VPatch.VTEXT,a,b));applyClear=true;}else if(a.text!==b.text){apply=appendPatch(apply,new VPatch(VPatch.VTEXT,a,b));}}else if(isWidget(b)){if(!isWidget(a)){applyClear=true;}apply=appendPatch(apply,new VPatch(VPatch.WIDGET,a,b));}if(apply){patch[index]=apply;}if(applyClear){clearState(a,patch,index);}}function diffChildren(a,b,patch,apply,index){var aChildren=a.children;var orderedSet=reorder(aChildren,b.children);var bChildren=orderedSet.children;var aLen=aChildren.length;var bLen=bChildren.length;var len=aLen>bLen?aLen:bLen;for(var i=0;i<len;i++){var leftNode=aChildren[i];var rightNode=bChildren[i];index+=1;if(!leftNode){if(rightNode){ // Excess nodes in b need to be added
apply=appendPatch(apply,new VPatch(VPatch.INSERT,null,rightNode));}}else {walk(leftNode,rightNode,patch,index);}if(isVNode(leftNode)&&leftNode.count){index+=leftNode.count;}}if(orderedSet.moves){ // Reorder nodes last
apply=appendPatch(apply,new VPatch(VPatch.ORDER,a,orderedSet.moves));}return apply;}function clearState(vNode,patch,index){ // TODO: Make this a single walk, not two
unhook(vNode,patch,index);destroyWidgets(vNode,patch,index);} // Patch records for all destroyed widgets must be added because we need
// a DOM node reference for the destroy function
function destroyWidgets(vNode,patch,index){if(isWidget(vNode)){if(typeof vNode.destroy==="function"){patch[index]=appendPatch(patch[index],new VPatch(VPatch.REMOVE,vNode,null));}}else if(isVNode(vNode)&&(vNode.hasWidgets||vNode.hasThunks)){var children=vNode.children;var len=children.length;for(var i=0;i<len;i++){var child=children[i];index+=1;destroyWidgets(child,patch,index);if(isVNode(child)&&child.count){index+=child.count;}}}else if(isThunk(vNode)){thunks(vNode,null,patch,index);}} // Create a sub-patch for thunks
function thunks(a,b,patch,index){var nodes=handleThunk(a,b);var thunkPatch=diff(nodes.a,nodes.b);if(hasPatches(thunkPatch)){patch[index]=new VPatch(VPatch.THUNK,null,thunkPatch);}}function hasPatches(patch){for(var index in patch){if(index!=="a"){return true;}}return false;} // Execute hooks when two nodes are identical
function unhook(vNode,patch,index){if(isVNode(vNode)){if(vNode.hooks){patch[index]=appendPatch(patch[index],new VPatch(VPatch.PROPS,vNode,undefinedKeys(vNode.hooks)));}if(vNode.descendantHooks||vNode.hasThunks){var children=vNode.children;var len=children.length;for(var i=0;i<len;i++){var child=children[i];index+=1;unhook(child,patch,index);if(isVNode(child)&&child.count){index+=child.count;}}}}else if(isThunk(vNode)){thunks(vNode,null,patch,index);}}function undefinedKeys(obj){var result={};for(var key in obj){result[key]=undefined;}return result;} // List diff, naive left to right reordering
function reorder(aChildren,bChildren){ // O(M) time, O(M) memory
var bChildIndex=keyIndex(bChildren);var bKeys=bChildIndex.keys;var bFree=bChildIndex.free;if(bFree.length===bChildren.length){return {children:bChildren,moves:null};} // O(N) time, O(N) memory
var aChildIndex=keyIndex(aChildren);var aKeys=aChildIndex.keys;var aFree=aChildIndex.free;if(aFree.length===aChildren.length){return {children:bChildren,moves:null};} // O(MAX(N, M)) memory
var newChildren=[];var freeIndex=0;var freeCount=bFree.length;var deletedItems=0; // Iterate through a and match a node in b
// O(N) time,
for(var i=0;i<aChildren.length;i++){var aItem=aChildren[i];var itemIndex;if(aItem.key){if(bKeys.hasOwnProperty(aItem.key)){ // Match up the old keys
itemIndex=bKeys[aItem.key];newChildren.push(bChildren[itemIndex]);}else { // Remove old keyed items
itemIndex=i-deletedItems++;newChildren.push(null);}}else { // Match the item in a with the next free item in b
if(freeIndex<freeCount){itemIndex=bFree[freeIndex++];newChildren.push(bChildren[itemIndex]);}else { // There are no free items in b to match with
// the free items in a, so the extra free nodes
// are deleted.
itemIndex=i-deletedItems++;newChildren.push(null);}}}var lastFreeIndex=freeIndex>=bFree.length?bChildren.length:bFree[freeIndex]; // Iterate through b and append any new keys
// O(M) time
for(var j=0;j<bChildren.length;j++){var newItem=bChildren[j];if(newItem.key){if(!aKeys.hasOwnProperty(newItem.key)){ // Add any new keyed items
// We are adding new items to the end and then sorting them
// in place. In future we should insert new items in place.
newChildren.push(newItem);}}else if(j>=lastFreeIndex){ // Add any leftover non-keyed items
newChildren.push(newItem);}}var simulate=newChildren.slice();var simulateIndex=0;var removes=[];var inserts=[];var simulateItem;for(var k=0;k<bChildren.length;){var wantedItem=bChildren[k];simulateItem=simulate[simulateIndex]; // remove items
while(simulateItem===null&&simulate.length){removes.push(remove(simulate,simulateIndex,null));simulateItem=simulate[simulateIndex];}if(!simulateItem||simulateItem.key!==wantedItem.key){ // if we need a key in this position...
if(wantedItem.key){if(simulateItem&&simulateItem.key){ // if an insert doesn't put this key in place, it needs to move
if(bKeys[simulateItem.key]!==k+1){removes.push(remove(simulate,simulateIndex,simulateItem.key));simulateItem=simulate[simulateIndex]; // if the remove didn't put the wanted item in place, we need to insert it
if(!simulateItem||simulateItem.key!==wantedItem.key){inserts.push({key:wantedItem.key,to:k});} // items are matching, so skip ahead
else {simulateIndex++;}}else {inserts.push({key:wantedItem.key,to:k});}}else {inserts.push({key:wantedItem.key,to:k});}k++;} // a key in simulate has no matching wanted key, remove it
else if(simulateItem&&simulateItem.key){removes.push(remove(simulate,simulateIndex,simulateItem.key));}}else {simulateIndex++;k++;}} // remove all the remaining nodes from simulate
while(simulateIndex<simulate.length){simulateItem=simulate[simulateIndex];removes.push(remove(simulate,simulateIndex,simulateItem&&simulateItem.key));} // If the only moves we have are deletes then we can just
// let the delete patch remove these items.
if(removes.length===deletedItems&&!inserts.length){return {children:newChildren,moves:null};}return {children:newChildren,moves:{removes:removes,inserts:inserts}};}function remove(arr,index,key){arr.splice(index,1);return {from:index,key:key};}function keyIndex(children){var keys={};var free=[];var length=children.length;for(var i=0;i<length;i++){var child=children[i];if(child.key){keys[child.key]=i;}else {free.push(i);}}return {keys:keys, // A hash of key name to index
free:free // An array of unkeyed item indices
};}function appendPatch(apply,patch){if(apply){if(isArray(apply)){apply.push(patch);}else {apply=[apply,patch];}return apply;}else {return patch;}}},{"../vnode/handle-thunk":24,"../vnode/is-thunk":25,"../vnode/is-vnode":27,"../vnode/is-vtext":28,"../vnode/is-widget":29,"../vnode/vpatch":32,"./diff-props":34,"x-is-array":12}]},{},[4])(4);});var elixir={Core:Core,Enum:Enum,VirtualDOM:VirtualDOM};var to_string=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(atom){return Symbol.keyFor(atom);}));var to_char_list=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(atom){return to_string.split('');}));var Elixir$ElixirScript$Atom={to_string:to_string,to_char_list:to_char_list};var build_if=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable(),Object.freeze([elixir.Core.Patterns.type(elixir.Core.Tuple,{values:[Symbol.for('do'),elixir.Core.Patterns.variable()]})])],function(condition,do_clause){return build_if(condition,Object.freeze([new elixir.Core.Tuple(Symbol.for('do'),do_clause),new elixir.Core.Tuple(Symbol.for('else'),null)]));}),elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable(),Object.freeze([elixir.Core.Patterns.type(elixir.Core.Tuple,{values:[Symbol.for('do'),elixir.Core.Patterns.variable()]}),elixir.Core.Patterns.type(elixir.Core.Tuple,{values:[Symbol.for('else'),elixir.Core.Patterns.variable()]})])],function(condition,do_clause,else_clause){return new elixir.Core.Tuple(Symbol.for('case'),Object.freeze([new elixir.Core.Tuple(Symbol.for('line'),15)]),Object.freeze([condition,Object.freeze([new elixir.Core.Tuple(Symbol.for('do'),Object.freeze([new elixir.Core.Tuple(Symbol.for('->'),Object.freeze([new elixir.Core.Tuple(Symbol.for('line'),16)]),Object.freeze([Object.freeze([new elixir.Core.Tuple(Symbol.for('when'),Object.freeze([new elixir.Core.Tuple(Symbol.for('line'),16)]),Object.freeze([new elixir.Core.Tuple(Symbol.for('x'),Object.freeze([new elixir.Core.Tuple(Symbol.for('line'),16)]),null),new elixir.Core.Tuple(Symbol.for('in'),Object.freeze([new elixir.Core.Tuple(Symbol.for('line'),16)]),Object.freeze([new elixir.Core.Tuple(Symbol.for('x'),Object.freeze([new elixir.Core.Tuple(Symbol.for('line'),16)]),null),Object.freeze([false,null])]))]))]),else_clause])),new elixir.Core.Tuple(Symbol.for('->'),Object.freeze([new elixir.Core.Tuple(Symbol.for('line'),18)]),Object.freeze([Object.freeze([new elixir.Core.Tuple(Symbol.for('_'),Object.freeze([new elixir.Core.Tuple(Symbol.for('line'),18)]),null)]),do_clause]))]))])]));}));var build_unless=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable(),Object.freeze([elixir.Core.Patterns.type(elixir.Core.Tuple,{values:[Symbol.for('do'),elixir.Core.Patterns.variable()]})])],function(condition,do_clause){return build_unless(condition,Object.freeze([new elixir.Core.Tuple(Symbol.for('do'),do_clause),new elixir.Core.Tuple(Symbol.for('else'),null)]));}),elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable(),Object.freeze([elixir.Core.Patterns.type(elixir.Core.Tuple,{values:[Symbol.for('do'),elixir.Core.Patterns.variable()]}),elixir.Core.Patterns.type(elixir.Core.Tuple,{values:[Symbol.for('else'),elixir.Core.Patterns.variable()]})])],function(condition,do_clause,else_clause){return new elixir.Core.Tuple(Symbol.for('if'),Object.freeze([new elixir.Core.Tuple(Symbol.for('line'),34)]),Object.freeze([condition,Object.freeze([new elixir.Core.Tuple(Symbol.for('do'),else_clause),new elixir.Core.Tuple(Symbol.for('else'),do_clause)])]));}));var is_bitstring$1=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(term){return is_binary(term)||term instanceof elixir.Core.BitString;}));var is_boolean$1=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(term){return typeof term==='boolean'||term instanceof Boolean;}));var min=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable()],function(first,second){return Math.min(first,second);}));var is_function$1=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(term){return is_function$1(term,0);}),elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable(),elixir.Core.Patterns.wildcard()],function(term){return typeof term==='function'||term instanceof Function;}));var is_atom=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(term){return (typeof term==="undefined"?"undefined":_typeof(term))==='symbol';}));var elem=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable()],function(tuple,index){return elixir.Core.Functions.apply(tuple,'get',Object.freeze([index]));}));var map_size=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(term){return elixir.Core.Functions.call_property(Object.keys(term),'length');}));var tuple_size=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(tuple){return elixir.Core.Functions.size(tuple);}));var is_tuple=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(term){return term instanceof elixir.Core.Tuple;}));var is_reference=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.wildcard()],function(){return false;}));var binary_part=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable()],function(binary,start,len){return binary.substring(start,len);}));var is_nil=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(term){return term===null;}));var is_pid=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(term){return term instanceof elixir.Core.PID;}));var tl=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(list){return list.slice(1);}));var hd=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(list){return list[0];}));var is_port=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.wildcard()],function(){return false;}));var is_list=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(term){return Array.isArray(term);}));var is_float=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(term){return is_number$1(term)&&!Number.isInteger(term);}));var round=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(number){return Math.round(number);}));var abs=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(number){return Math.abs(number);}));var trunc=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(number){return Math.floor(number);}));var is_integer=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(term){return Number.isInteger(term);}));var is_number$1=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(term){return typeof term==='number'||term instanceof Number;}));var apply$1=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable()],function(fun,args){return elixir.Core.Functions.apply(fun,args);}),elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable()],function(module,fun,args){var _elixir$Core$Patterns=elixir.Core.Patterns.match(elixir.Core.Patterns.variable(),elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(x){return fun;},function(x){return elixir.Enum.member__qmark__(Object.freeze([false,null]),x);}),elixir.Core.Patterns.make_case([elixir.Core.Patterns.wildcard()],function(){return Elixir$ElixirScript$Atom.to_string(fun);})).call(this,elixir.Core.is_atom(fun)));var _elixir$Core$Patterns2=_slicedToArray(_elixir$Core$Patterns,1);var fun1=_elixir$Core$Patterns2[0];return elixir.Core.Functions.apply(module,fun,args);}));var is_binary=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(term){return typeof term==='string';}));var is_map=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(term){return (typeof term==="undefined"?"undefined":_typeof(term))==='object'||term instanceof Object;}));var length=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(term){return elixir.Core.Functions.call_property(term,'length');}));var max=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable()],function(first,second){return Math.max(first,second);}));var Elixir$ElixirScript$Kernel={is_bitstring:is_bitstring$1,is_boolean:is_boolean$1,min:min,is_function:is_function$1,is_atom:is_atom,elem:elem,map_size:map_size,tuple_size:tuple_size,is_tuple:is_tuple,is_reference:is_reference,binary_part:binary_part,is_nil:is_nil,is_pid:is_pid,tl:tl,hd:hd,is_port:is_port,is_list:is_list,is_float:is_float,round:round,abs:abs,trunc:trunc,is_integer:is_integer,is_number:is_number$1,apply:apply$1,is_binary:is_binary,is_map:is_map,length:length,max:max};var global$1=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([],function(){return elixir.Core.Functions.call_property(elixir.Core.Functions,'get_global');}));var Elixir$ElixirScript$JS={global:global$1};var do_has_key__qmark__=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([Object.freeze([]),elixir.Core.Patterns.wildcard()],function(){return false;}),elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable()],function(kw,key){return elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.type(elixir.Core.Tuple,{values:[elixir.Core.Patterns.variable(),elixir.Core.Patterns.wildcard()]})],function(the_key){return true;},function(the_key){return the_key==key;}),elixir.Core.Patterns.make_case([elixir.Core.Patterns.wildcard()],function(){return do_has_key__qmark__(Elixir$ElixirScript$Kernel.tl(kw),key);})).call(this,Elixir$ElixirScript$Kernel.hd(kw));}));var do_get=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable()],function(kw,key){return elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.type(elixir.Core.Tuple,{values:[elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable()]})],function(kw_key,value){return value;},function(kw_key,value){return kw_key==key;}),elixir.Core.Patterns.make_case([elixir.Core.Patterns.wildcard()],function(){return do_get(Elixir$ElixirScript$Kernel.tl(kw),key);})).call(this,Elixir$ElixirScript$Kernel.hd(kw));}));var has_key__qmark__=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable()],function(kw,key){return do_has_key__qmark__(kw,key);}));var get=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable()],function(kw,key){return get(kw,key,null);}),elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable()],function(kw,key,default_value){return elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([true],function(){return do_get(kw,key);}),elixir.Core.Patterns.make_case([false],function(){return default_value;})).call(this,has_key__qmark__(kw,key));}));var Elixir$ElixirScript$Keyword={has_key__qmark__:has_key__qmark__,get:get};var start=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable()],function(dom_root,render_func,args){var _elixir$Core$Patterns3=elixir.Core.Patterns.match(elixir.Core.Patterns.variable(),elixir.Core.Functions.call_property(elixir.Core.Functions.call_property(elixir.Core.Functions.call_property(Elixir$ElixirScript$JS,'global'),'processes'),'spawn'));var _elixir$Core$Patterns4=_slicedToArray(_elixir$Core$Patterns3,1);var pid=_elixir$Core$Patterns4[0];var _elixir$Core$Patterns5=elixir.Core.Patterns.match(elixir.Core.Patterns.variable(),render_func.apply(null,args));var _elixir$Core$Patterns6=_slicedToArray(_elixir$Core$Patterns5,1);var tree=_elixir$Core$Patterns6[0];var _elixir$Core$Patterns7=elixir.Core.Patterns.match(elixir.Core.Patterns.variable(),elixir.VirtualDOM.create(tree));var _elixir$Core$Patterns8=_slicedToArray(_elixir$Core$Patterns7,1);var root_node=_elixir$Core$Patterns8[0];dom_root.appendChild(root_node);elixir.Core.Functions.call_property(elixir.Core.Functions.call_property(Elixir$ElixirScript$JS,'global'),'processes').put(pid,'state',new elixir.Core.Tuple(root_node,tree,render_func));return new elixir.Core.Tuple(Symbol.for('ok'),pid);}),elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable()],function(dom_root,render_func,args,options){var _elixir$Core$Patterns9=elixir.Core.Patterns.match(elixir.Core.Patterns.variable(),elixir.Core.Functions.call_property(elixir.Core.Functions.call_property(elixir.Core.Functions.call_property(Elixir$ElixirScript$JS,'global'),'processes'),'spawn'));var _elixir$Core$Patterns10=_slicedToArray(_elixir$Core$Patterns9,1);var pid=_elixir$Core$Patterns10[0];elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(x){return null;},function(x){return elixir.Enum.member__qmark__(Object.freeze([false,null]),x);}),elixir.Core.Patterns.make_case([elixir.Core.Patterns.wildcard()],function(){var _elixir$Core$Patterns11=elixir.Core.Patterns.match(elixir.Core.Patterns.variable(),elixir.Core.Functions.call_property(elixir.Core.Functions.call_property(Elixir$ElixirScript$JS,'global'),'processes').register(Elixir$ElixirScript$Keyword.get(options,Symbol.for('name')),pid));var _elixir$Core$Patterns12=_slicedToArray(_elixir$Core$Patterns11,1);var pid1=_elixir$Core$Patterns12[0];return pid1;})).call(this,Elixir$ElixirScript$Keyword.has_key__qmark__(options,Symbol.for('name')));var _elixir$Core$Patterns13=elixir.Core.Patterns.match(elixir.Core.Patterns.variable(),render_func.apply(null,args));var _elixir$Core$Patterns14=_slicedToArray(_elixir$Core$Patterns13,1);var tree=_elixir$Core$Patterns14[0];var _elixir$Core$Patterns15=elixir.Core.Patterns.match(elixir.Core.Patterns.variable(),elixir.VirtualDOM.create(tree));var _elixir$Core$Patterns16=_slicedToArray(_elixir$Core$Patterns15,1);var root_node=_elixir$Core$Patterns16[0];dom_root.appendChild(root_node);elixir.Core.Functions.call_property(elixir.Core.Functions.call_property(Elixir$ElixirScript$JS,'global'),'processes').put(pid,'state',new elixir.Core.Tuple(root_node,tree,render_func));return new elixir.Core.Tuple(Symbol.for('ok'),pid);}));var render$1=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable()],function(view,args){var _elixir$Core$Patterns17=elixir.Core.Patterns.match(elixir.Core.Patterns.type(elixir.Core.Tuple,{values:[elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable()]}),elixir.Core.Functions.call_property(elixir.Core.Functions.call_property(Elixir$ElixirScript$JS,'global'),'processes').get(view,'state'));var _elixir$Core$Patterns18=_slicedToArray(_elixir$Core$Patterns17,3);var root_node=_elixir$Core$Patterns18[0];var tree=_elixir$Core$Patterns18[1];var render_func=_elixir$Core$Patterns18[2];var _ref=new elixir.Core.Tuple(root_node,tree,render_func);var _elixir$Core$Patterns19=elixir.Core.Patterns.match(elixir.Core.Patterns.variable(),render_func.apply(null,args));var _elixir$Core$Patterns20=_slicedToArray(_elixir$Core$Patterns19,1);var new_tree=_elixir$Core$Patterns20[0];var _elixir$Core$Patterns21=elixir.Core.Patterns.match(elixir.Core.Patterns.variable(),elixir.VirtualDOM.diff(tree,new_tree));var _elixir$Core$Patterns22=_slicedToArray(_elixir$Core$Patterns21,1);var patches=_elixir$Core$Patterns22[0];var _elixir$Core$Patterns23=elixir.Core.Patterns.match(elixir.Core.Patterns.variable(),elixir.VirtualDOM.patch(root_node,patches));var _elixir$Core$Patterns24=_slicedToArray(_elixir$Core$Patterns23,1);var root_node1=_elixir$Core$Patterns24[0];elixir.Core.Functions.call_property(elixir.Core.Functions.call_property(Elixir$ElixirScript$JS,'global'),'processes').put(view,'state',new elixir.Core.Tuple(root_node,new_tree,render_func));return Symbol.for('ok');}));var stop=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(view){elixir.Core.Functions.call_property(elixir.Core.Functions.call_property(Elixir$ElixirScript$JS,'global'),'processes').exit(view);return Symbol.for('ok');}));var Elixir$ElixirScript$View={start:start,render:render$1,stop:stop};var to_string$1=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([null],function(){return '';}),elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(atom){return Elixir$ElixirScript$Atom.to_string(atom);}));var Elixir$ElixirScript$String$Chars$DefImpl$Elixir$Atom={'Type':Symbol,'Implementation':{to_string:to_string$1}};var to_string$2=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(thing){return thing;},function(thing){return Elixir$ElixirScript$Kernel.is_binary(thing);}),elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(thing){return elixir.Core.Functions.call_property(thing,'toString');}));var Elixir$ElixirScript$String$Chars$DefImpl$Elixir$BitString={'Type':elixir.Core.BitString,'Implementation':{to_string:to_string$2}};var to_string$3=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(float){return elixir.Core.Functions.call_property(float,'toString');}));var Elixir$ElixirScript$String$Chars$DefImpl$Elixir$Float={'Type':elixir.Core.Float,'Implementation':{to_string:to_string$3}};var to_string$4=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(integer){return elixir.Core.Functions.call_property(integer,'toString');}));var Elixir$ElixirScript$String$Chars$DefImpl$Elixir$Integer={'Type':elixir.Core.Integer,'Implementation':{to_string:to_string$4}};var to_string$5=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(list){return elixir.Core.Functions.call_property(list,'toString');}));var Elixir$ElixirScript$String$Chars$DefImpl$Elixir$List={'Type':Array,'Implementation':{to_string:to_string$5}};var to_string$6=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(tuple){return elixir.Core.Functions.call_property(tuple,'toString');}));var Elixir$ElixirScript$String$Chars$DefImpl$Elixir$Tuple={'Type':elixir.Core.Tuple,'Implementation':{to_string:to_string$6}};var impls=[];impls.push(Elixir$ElixirScript$String$Chars$DefImpl$Elixir$Atom);impls.push(Elixir$ElixirScript$String$Chars$DefImpl$Elixir$BitString);impls.push(Elixir$ElixirScript$String$Chars$DefImpl$Elixir$Float);impls.push(Elixir$ElixirScript$String$Chars$DefImpl$Elixir$Integer);impls.push(Elixir$ElixirScript$String$Chars$DefImpl$Elixir$List);impls.push(Elixir$ElixirScript$String$Chars$DefImpl$Elixir$Tuple);var Elixir$ElixirScript$String$Chars=elixir.Core.Functions.defprotocol({to_string:function to_string(){}});var _iteratorNormalCompletion29=true;var _didIteratorError29=false;var _iteratorError29=undefined;try{for(var _iterator29=impls[Symbol.iterator](),_step29;!(_iteratorNormalCompletion29=(_step29=_iterator29.next()).done);_iteratorNormalCompletion29=true){var _step29$value=_step29.value;var Type$1=_step29$value.Type$1;var Implementation=_step29$value.Implementation;elixir.Core.Functions.defimpl(Elixir$ElixirScript$String$Chars,Type$1,Implementation);}}catch(err){_didIteratorError29=true;_iteratorError29=err;}finally {try{if(!_iteratorNormalCompletion29&&_iterator29.return){_iterator29.return();}}finally {if(_didIteratorError29){throw _iteratorError29;}}}var remove=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(id){return window.fetch('/api/todo/'+Elixir$ElixirScript$String$Chars.to_string(id),Object.freeze({method:'delete'})).then(elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(response){return list();}))).catch(elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(err){return console.debug(err);})));}));var update=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable()],function(id,completed){return window.fetch('/api/todo/'+Elixir$ElixirScript$String$Chars.to_string(id),Object.freeze({method:'put',headers:Object.freeze({'Content-type':'application/json'}),body:JSON.stringify(Object.freeze({completed:completed}))})).then(elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(response){return list();}))).catch(elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(err){return console.debug(err);})));}));var list=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([],function(){return window.fetch('/api/todo').then(elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(response){return elixir.Core.Functions.call_property(response,'json').then(elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(todos){return Elixir$ElixirScript$View.render(Symbol.for('view'),Object.freeze([todos]));})));}))).catch(elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(err){return console.debug(err);})));}));var add=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(the_title){return window.fetch('/api/todo',Object.freeze({method:'post',headers:Object.freeze({'Content-type':'application/json'}),body:JSON.stringify(Object.freeze({title:the_title}))})).then(elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(response){return list();}))).catch(elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(err){return console.debug(err);})));}));var Elixir$Todo$Data={remove:remove,update:update,list:list,add:add};var process_event=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.capture(elixir.Core.Patterns.type(KeyboardEvent,{which:13}))],function(event){Elixir$Todo$Data.add(elixir.Core.Functions.call_property(elixir.Core.Functions.call_property(event,'target'),'value'));return Object.assign(elixir.Core.Functions.call_property(event,'target'),Object.freeze({value:''}));}),elixir.Core.Patterns.make_case([elixir.Core.Patterns.capture(elixir.Core.Patterns.type(KeyboardEvent,{}))],function(event){return console.debug(event);}));var main=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([],function(){var _elixir$Core$Patterns25=elixir.Core.Patterns.match(elixir.Core.Patterns.type(elixir.Core.Tuple,{values:[Symbol.for('ok'),elixir.Core.Patterns.variable()]}),Elixir$ElixirScript$View.start(document.getElementById('app'),elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(__1){return render(__1);})),Object.freeze([Object.freeze([])]),Object.freeze([new elixir.Core.Tuple(Symbol.for('name'),Symbol.for('view'))])));var _elixir$Core$Patterns26=_slicedToArray(_elixir$Core$Patterns25,1);var view=_elixir$Core$Patterns26[0];var _ref=new elixir.Core.Tuple(view);return elixir.Core.Functions.call_property(Elixir$Todo$Data,'list');}));var render=elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(todos){return elixir.VirtualDOM.h('div',Object.freeze({}),Object.freeze([elixir.VirtualDOM.h('section',Object.freeze({id:'todoapp'}),Object.freeze([elixir.VirtualDOM.h('header',Object.freeze({id:'header'}),Object.freeze([elixir.VirtualDOM.h('h1',Object.freeze({}),Object.freeze(['todos'])),elixir.VirtualDOM.h('input',Object.freeze({id:'new-todo',placeholder:'What needs to be done?',autofocus:true,onkeypress:elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(event){return process_event(event);}))}),Object.freeze([]))])),elixir.VirtualDOM.h('section',Object.freeze({id:'main'}),Object.freeze([elixir.VirtualDOM.h('ul',Object.freeze({id:'todo-list'}),Object.freeze([elixir.Enum.map(todos,elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(todo){var _elixir$Core$Patterns27=elixir.Core.Patterns.match(elixir.Core.Patterns.type(elixir.Core.Tuple,{values:[elixir.Core.Patterns.variable(),elixir.Core.Patterns.variable()]}),elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(x){return new elixir.Core.Tuple('','');},function(x){return elixir.Enum.member__qmark__(Object.freeze([false,null]),x);}),elixir.Core.Patterns.make_case([elixir.Core.Patterns.wildcard()],function(){return new elixir.Core.Tuple('completed','checked');})).call(this,elixir.Core.Functions.call_property(todo,'completed')));var _elixir$Core$Patterns28=_slicedToArray(_elixir$Core$Patterns27,2);var the_completed=_elixir$Core$Patterns28[0];var checked=_elixir$Core$Patterns28[1];var _ref=new elixir.Core.Tuple(the_completed,checked);return elixir.VirtualDOM.h('li',Object.freeze({data_id:elixir.Core.Functions.call_property(todo,'id'),className:the_completed}),Object.freeze([elixir.VirtualDOM.h('div',Object.freeze({className:'view'}),Object.freeze([elixir.VirtualDOM.h('input',Object.freeze({className:'toggle',type:'checkbox',checked:elixir.Core.Functions.call_property(todo,'completed'),onchange:elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(event){return Elixir$Todo$Data.update(elixir.Core.Functions.call_property(elixir.Core.Functions.call_property(elixir.Core.Functions.call_property(elixir.Core.Functions.call_property(event,'target'),'parentElement'),'parentElement'),'data_id'),elixir.Core.Functions.call_property(elixir.Core.Functions.call_property(event,'target'),'checked'));}))}),Object.freeze([])),elixir.VirtualDOM.h('label',Object.freeze({}),Object.freeze([elixir.Core.Functions.call_property(todo,'title')])),elixir.VirtualDOM.h('button',Object.freeze({className:'destroy',onclick:elixir.Core.Patterns.defmatch(elixir.Core.Patterns.make_case([elixir.Core.Patterns.variable()],function(event){return Elixir$Todo$Data.remove(elixir.Core.Functions.call_property(elixir.Core.Functions.call_property(elixir.Core.Functions.call_property(elixir.Core.Functions.call_property(event,'target'),'parentElement'),'parentElement'),'data_id'));}))}),Object.freeze([]))]))]));})))]))])),elixir.VirtualDOM.h('footer',Object.freeze({id:'footer'}),Object.freeze([]))]))]));}));var Elixir_Todo={main:main,render:render};exports.default=Elixir_Todo;